webpackJsonp([1],{"+uS9":function(t,e){},CjGi:function(t,e){},LLNR:function(t,e){},NHnr:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=o("Ml+6"),i=o("I3G/"),n=o.n(i),a={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},staticRenderFns:[]},r=o("VU/8")({name:"App"},a,!1,null,null,null).exports,l=o("NYxO"),c=o("lbHh"),p=o.n(c),u={state:{sidebar:{opened:!+p.a.get("sidebarStatus")},theme:"default",livenewsChannels:p.a.get("livenewsChannels")||"[]"},mutations:{TOGGLE_SIDEBAR:function(t){t.sidebar.opened?p.a.set("sidebarStatus",1):p.a.set("sidebarStatus",0),t.sidebar.opened=!t.sidebar.opened}},actions:{ToggleSideBar:function(t){(0,t.commit)("TOGGLE_SIDEBAR")}}},h={navbar:{list:[{name:"File",text:"File",children:[{name:"New",text:"New"},{name:"Import",text:"Import"},{name:"Export JSON",text:"Export JSON"},{name:"Publish",text:"Publish"}]},{name:"Edit",text:"Edit",children:[{name:"Undo",text:"Undo"},{name:"Redo",text:"Undo"},{name:"Clear History",text:"Clear History"},{name:"Clone",text:"Clone"},{name:"Delete",text:"Delete"},{name:"Select All",text:"Select All"}]}]}},d=o("BO1k"),m=o.n(d),v=o("fZjL"),f=o.n(v),H={state:{arr:[],maxID:0,selectHotType:"",selectUploadPicture:"",selectJumpScene:"",inputHotIntroduction:"",inputHotUrl:"",newIsDeleteHotSpot:!1,position:[],pid:[],activeJumpHotSpot:!1,inactiveJumpHotSpot:!1,activeImageHotSpot:!1,inactiveImageHotSpot:!1,activeUrlHotSpot:!1,inactiveUrlHotSpot:!1,activePost:{},sceneDelete:{},oldselected:{},isVideoTransformX:!1,valueX:1,isVideoTransformY:!1,valueY:1,isVideoRotate:!1,valueR:1,videoRotate:0,isVideoScale:!1,valueS:.1,videoScale:1,videoGroup:[],imgType:"Auto",isAddProject:!0,dateVal:"",pickerOptions0:{disabledDate:function(t){return t.getTime()<Date.now()-864e5}},imgFile:{fileName:"1_sphere.jpg",fileUrl:["/static/textures/1_sphere.jpg"]},fileUrlArr:[],isHotspot:!1,isImageHotspot:!1,isVideoHotspot:!1,isSubmit:!1,hotSpots:[],imgHotSpots:{},sum:[],isJumpHotSpot:!1,isVideoHotSpot:!1,isImgHotSpot:!1,hotSpotsImgs:[{key:"tianyu01.jpg",value:"tianyu01.jpg"},{key:"tianyu02.jpg",value:"tianyu02.jpg"}],tempLocation:{},isDeleteHotSpot:!1,jumpHotSpots:[],urlHotSpots:[],imageHotSpots:[],viewNo:"",panoUploadUrl:"",tietu:[],output:'<?xml version="1.0" encoding="UTF-8"?>'},mutations:{addArr:function(t,e){t.arr=e},saveimgType:function(t,e){t.imgType=e},saveimgFile:function(t,e){t.imgFile=e},saveFileUrlArr:function(t,e){t.fileUrlArr=e},saveHotSpotsImgs:function(t,e){t.hotSpotsImgs=e},saveTietu:function(t,e){t.tietu=e},isHotspot:function(t){t.isHotspot=!t.isHotspot},isImageHotspot:function(t){t.isImageHotspot=!t.isImageHotspot},isVideoHotspot:function(t){t.isVideoHotspot=!t.isVideoHotspot},isSubmit:function(t){t.isSubmit=!t.isSubmit},hotSpots:function(t,e){t.hotSpots=e.sprites},imgHotSpots:function(t,e){t.imgHotSpots=e.imgHotSpots},saveInformation:function(t){var e=t.hotSpots,o=t.imgHotSpots,s=0;t.isSubmit=!t.isSubmit;var i=setInterval(function(){if(s+=100,!(t.hotSpots===e&&500!=s||t.imgHotSpots===o&&500!=s)){clearInterval(i);for(var n=t.jumpHotSpots,a=t.urlHotSpots,r=t.imageHotSpots,l=[],c=[],p=[],u=0;u<n.length;u++)for(var h=0;h<t.hotSpots.length;h++)n[u].position[0]==t.hotSpots[h].position[0]&&l.push(n[u]);for(var d=0;d<a.length;d++)for(var v=0;v<t.imgHotSpots.length;v++)a[d].position[0]==t.imgHotSpots[v].position[0]&&c.push(a[d]);for(var H=0;H<r.length;H++)for(var g=0;g<t.imgHotSpots.length;g++)r[H].position[0]==t.imgHotSpots[g].position[0]&&p.push(r[H]);t.jumpHotSpots=l,t.urlHotSpots=c,t.imageHotSpots=p;var E=!0,w=f()(t),S={},T=!0,y=!1,R=void 0;try{for(var $,x=m()(w);!(T=($=x.next()).done);T=!0){var M=$.value;"sum"!=M&&(S[M]=t[M])}}catch(t){y=!0,R=t}finally{try{!T&&x.return&&x.return()}finally{if(y)throw R}}for(var b=0;b<t.sum.length;b++)t.sum[b].imgFile.fileUrl[0]==S.imgFile.fileUrl[0]&&(E=!1,t.sum[b]=S);E&&t.sum.push(S)}},100)},clearHotSpots:function(t){t.hotSpots=[],t.imgHotSpots=[],t.jumpHotSpots=[],t.urlHotSpots=[],t.imageHotSpots=[]},showJumpHotSpot:function(t){t.isJumpHotSpot=!0,t.isImgHotSpot=!1,t.isVideoHotSpot=!1,t.selectHotType="",t.selectUploadPicture="",t.selectJumpScene=""},showImgHotSpot:function(t){t.isImgHotSpot=!0,t.isJumpHotSpot=!1,t.isVideoHotSpot=!1,t.selectHotType="",t.selectUploadPicture="",t.selectJumpScene=""},showVideoHotSpot:function(t){t.isVideoHotSpot=!0,t.isJumpHotSpot=!1,t.isImgHotSpot=!1,t.selectHotType="",t.selectUploadPicture="",t.selectJumpScene=""},hideHotSpot:function(t){t.isImgHotSpot=!1,t.isJumpHotSpot=!1,t.isVideoHotSpot=!1},saveTempLocation:function(t,e){t.tempLocation=e},saveJumpHotSpot:function(t,e){var o={};o.hotTarget=e.hotTarget,o.hotIntroduction=e.hotIntroduction,o.position=t.tempLocation.location,o.panAndTilt=t.tempLocation.panAndTilt,t.jumpHotSpots.push(o)},saveUrlHotSpot:function(t,e){var o={};o.hotUrl=e.hotUrl,o.position=t.tempLocation.location,o.panAndTilt=t.tempLocation.panAndTilt,t.urlHotSpots.push(o)},saveImageHotSpot:function(t,e){var o={};o.hotImage=e.hotImage,o.position=t.tempLocation.location,o.panAndTilt=t.tempLocation.panAndTilt,t.imageHotSpots.push(o)},saveViewNo:function(t,e){t.viewNo=e.viewNo,t.panoUploadUrl="/web/file/"+t.viewNo+"/pano/3"},deleteHotSpot:function(t){t.isDeleteHotSpot=!0},deletedHotSpot:function(t){t.isDeleteHotSpot=!1,t.newIsDeleteHotSpot=!1},newDeleteHotSpot:function(t,e){t.newIsDeleteHotSpot=!0,t.pid=e.pid,t.position=e.position},deleteJumpHotSpot:function(t,e){t.arr[e.scene].hotspot.splice(e.index,1),t.maxID=t.maxID-3},deleteImageHotSpot:function(t,e){t.arr[e.scene].polyhotspot.imageHotSpots.splice(e.index,1),t.maxID=t.maxID-2},deleteUrlHotSpot:function(t,e){t.arr[e.scene].polyhotspot.urlHotSpots.splice(e.index,1),t.maxID=t.maxID-2},deleteScene:function(t,e){t.sceneDelete={index:e},t.arr.splice(e,1),t.fileUrlArr.splice(e,1)},createXmlString:function(t,e){t.output=e},showActiveJumpSpot:function(t,e){t.activePost=e,t.activeJumpHotSpot=!t.activeJumpHotSpot},showInactiveJumpSpot:function(t){t.inactiveJumpHotSpot=!t.inactiveJumpHotSpot},showActiveImageSpot:function(t,e){t.activePost=e,t.activeImageHotSpot=!t.activeImageHotSpot},showInactiveImageSpot:function(t){t.inactiveImageHotSpot=!t.inactiveImageHotSpot},showActiveUrlSpot:function(t,e){t.activePost=e,t.activeUrlHotSpot=!t.activeUrlHotSpot},showInactiveUrlSpot:function(t){t.inactiveUrlHotSpot=!t.inactiveUrlHotSpot},addMaxID:function(t,e){t.maxID=e},saveTreeHotIntroduction:function(t,e){t.arr[e.i].hotspot[e.l].title="{"+e.result+"}"},savehotIntroduction:function(t,e){t.jumpHotSpots[e.k].hotIntroduction=e.result},saveTreeHotUrl:function(t,e){t.arr[e.i].polyhotspot.urlHotSpots[e.l].url="http://"+e.result},savehotUrl:function(t,e){t.urlHotSpots[e.k].hotUrl=e.result},saveTreeJumpScene:function(t,e){t.arr[e.i].hotspot[e.l].url="{"+e.result.replace("场景","node")+"}"},savehotTarget:function(t,e){t.jumpHotSpots[e.k].hotTarget=e.result},saveTreeUploadPicture:function(t,e){t.arr[e.i].polyhotspot.imageHotSpots[e.l].target="images/"+e.result},savehotImage:function(t,e){t.imageHotSpots[e.k].hotImage=e.result},changeJumpHotSpot:function(t,e){t.jumpHotSpots[e.index].hotIntroduction=e.hotIntroduction,t.jumpHotSpots[e.index].hotTarget=e.hotTarget},changeImageHotSpot:function(t,e){t.imageHotSpots[e.index].hotImage=e.hotImage},changeUrlHotSpot:function(t,e){t.urlHotSpots[e.index].hotUrl=e.hotUrl},changeTreeJumpHotSpot:function(t,e){t.arr[e.scene].hotspot[e.index].title="{"+e.hotIntroduction+"}",t.arr[e.scene].hotspot[e.index].url="{"+e.hotTarget.replace("场景","node")+"}"},changeTreeUrlHotSpot:function(t,e){t.arr[e.scene].polyhotspot.urlHotSpots[e.index].url="http://"+e.hotUrl},changeTreeImageHotSpot:function(t,e){t.arr[e.scene].polyhotspot.imageHotSpots[e.index].target="images/"+e.hotImage},saveTreeJumpHotSpot:function(t,e){var o={};o.id="Point"+(t.jumpHotSpots.length+1),o.position=t.tempLocation.location,o.panAndTilt=t.tempLocation.panAndTilt,o.title="{"+e.hotIntroduction+"}",o.url="{"+e.hotTarget.replace("场景","node")+"}",t.arr[e.scene].hotspot.push(o)},saveTreeUrlHotSpot:function(t,e){var o={};o.id="hpimage"+e.scene+t.urlHotSpots.length,o.position=t.tempLocation.location,o.panAndTilt=t.tempLocation.panAndTilt,o.url="http://"+e.hotUrl,t.arr[e.scene].polyhotspot.urlHotSpots.push(o)},saveTreeImageHotSpot:function(t,e){var o={id:"hpimage"};o.position=t.tempLocation.location,o.panAndTilt=t.tempLocation.panAndTilt,o.target="images/"+e.hotImage,t.arr[e.scene].polyhotspot.imageHotSpots.push(o)},saveSelectHotType:function(t,e){t.selectHotType=e},saveSelectUploadPicture:function(t,e){t.selectUploadPicture=e},saveSelectJumpScene:function(t,e){t.selectJumpScene=e},saveInputHotIntroduction:function(t,e){t.inputHotIntroduction=e},saveInputHotUrl:function(t,e){t.inputHotUrl=e},saveOldSelected:function(t,e){t.oldselected=e},changeOldSelectedX:function(t,e){t.valueX=parseInt(e),t.isVideoTransformX=!t.isVideoTransformX},changeOldSelectedY:function(t,e){t.valueY=parseInt(e),t.isVideoTransformY=!t.isVideoTransformY},changeOldSelectedR:function(t,e){t.valueR=parseInt(e),t.videoRotate+=parseInt(e),t.isVideoRotate=!t.isVideoRotate},changeOldSelectedS:function(t,e){t.valueS=parseInt(e),t.videoScale+=parseFloat(e),t.videoScale=Math.round(10*t.videoScale)/10,t.isVideoScale=!t.isVideoScale},saveVideoGroup:function(t,e){t.videoGroup.push(e)},emptyVideoGroup:function(t){t.videoGroup=[]},saveOldselectedVector:function(t,e){t.oldselected.vector=e},saveOldselectedSelect:function(t,e){t.oldselected.select[0]=e[0],t.oldselected.select[1]=e[1],t.oldselected.select[2]=e[2]},updateValueX:function(t,e){t.valueX=e},updateValueY:function(t,e){t.valueY=e},updateValueR:function(t,e){t.valueR=e},updateValueS:function(t,e){t.valueS=e}},actions:{saveimgFile:function(t,e){(0,t.commit)("saveimgFile",e)},saveInformation:function(t){(0,t.commit)("saveInformation")},isHotspot:function(t){(0,t.commit)("isHotspot")},isSubmit:function(t){(0,t.commit)("isSubmit")},isImageHotspot:function(t){(0,t.commit)("isImageHotspot")},isVideoHotspot:function(t){(0,t.commit)("isVideoHotspot")},hotSpots:function(t,e){(0,t.commit)("hotSpots",e)},imgHotSpots:function(t,e){(0,t.commit)("imgHotSpots",e)}}};n.a.use(l.a);var g=new l.a.Store({modules:{app:u,nav:h,test:H}}),E=o("/ocq"),w=o("Dd8w"),S=o.n(w),T={created:function(){this.getBreadcrumb()},data:function(){return{levelList:null}},methods:{showName:function(){new Object},getBreadcrumb:function(){var t=this.$route.matched.filter(function(t){return t.name}),e=t[0];!e||"首页"===e.name&&""===e.path||(t=[{name:"首页",path:"/"}].concat(t)),this.levelList=t}},watch:{$route:function(){this.getBreadcrumb(),this.activeIndex(),this.jobForTest(),this.thanksALot()}}},y={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-breadcrumb",{staticClass:"app-levelbar",attrs:{separator:"/"}},t._l(t.levelList,function(e,s){return o("el-breadcrumb-item",{key:e},["noredirect"===e.redirect||s==t.levelList.length-1?o("router-link",{staticClass:"no-redirect",attrs:{to:""}},[t._v(t._s(e.name))]):o("router-link",{attrs:{to:e.path}},[t._v(t._s(e.name))])],1)}))},staticRenderFns:[]};var R={components:{Levelbar:o("VU/8")(T,y,!1,function(t){o("n3AO")},"data-v-236a3b51",null).exports},data:function(){return{fileList:[],dialogFormVisible:!1,shortName:"",address:"",longitude:"",latitude:"",proInfo:"",createUserNo:"84d2a1ed-d26e-4772-a296-ce8c111132d4",companyNo:"84d2a1ed-d26e-4772-a296-ce8c111132d4",token:"4KD8DLL84D2A1ED-D26E-4772-A296-CE8C111132D4",formLabelWidth:"120px"}},computed:S()({},Object(l.b)(["sidebar","name","avatar"]),{userName:function(){}}),methods:{toggleSideBar:function(){this.$store.dispatch("ToggleSideBar")},logout:function(){this.$store.dispatch("LogOut").then(function(){location.reload()})},sendProject:function(){this.dialogFormVisible=!1;var t=this;this.$ajax({url:"/web/spaceview/",method:"post",data:{shortName:t.shortName,address:t.address,longitude:t.longitude,latitude:t.latitude,info:t.proInfo,createUserNo:t.createUserNo,companyNo:t.companyNo,_token:t.token,viewType:0,status:1},transformRequest:[function(t){var e="";for(var o in t)e+=encodeURIComponent(o)+"="+encodeURIComponent(t[o])+"&";return e}],headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}}).then(function(e){var o=e.data.data;t.$store.commit("saveViewNo",{viewNo:o}),console.log(o)}).catch(function(t){console.log(t)})},drawHotspot:function(){this.$store.dispatch("isHotspot")},drawImageHotspot:function(){this.$store.dispatch("isImageHotspot")},drawVideoHotspot:function(){this.$store.dispatch("isVideoHotspot")},submitInformation:function(){this.$store.dispatch("isSubmit")},saveInformation:function(){this.$store.dispatch("saveInformation")},deleteHotSpot:function(){this.$store.commit("deleteHotSpot")},createXmlString:function(){for(var t='<?xml version="1.0" encoding="UTF-8"?><tour start="node1">',e=this.$store.state.test.sum,o=[],s=[],i=[],n=0,a=e.length;n<a;n++){var r="node"+(n+1);o.push(e[n].imgFile.fileName),s.push(e[n].hotSpots),i.push(e[n].target),t+='<panorama id="'+r+'">\n                         <input overlap="1" levelingpitch="0" width="1920" levelingroll="0" leveltileurl="tiles/'+e[n].imgFile.fileName.substring(0,e[n].imgFile.fileName.lastIndexOf("."))+'/cf_%c/l_%l/c_%x/tile_%y.jpg" fileName="'+e[n].fileUrlArr[n].fileName+'" fileUrl="'+e[n].fileUrlArr[n].fileUrl+'" height="1920" levelbiashidpi="0.400" levelbias="0.400" leveltilesize="510">\n                           <level width="1920" preload="0" height="1920" predecode="0"/>\n                           <level width="960" preload="0" height="960" predecode="0"/>\n                           <level width="480" preload="1" height="480" predecode="1"/>\n                           <preview color="0x808080" strip="1"/>\n                         </input>\n                         <view fovmode="0" pannorth="0">\n                           <start fov="70" pan="0" tilt="0"/>\n                           <min fov="5" pan="0" tilt="-90"/>\n                           <max fov="120" pan="360" tilt="90"/>\n                         </view>\n                         <userdata author="" info="" latitude="" comment="" copyright="" title="" tags="" longitude="" source="" description="" datetime=""/>\n                         <hotspots width="180" wordwrap="1" height="20">\n                           <label background="1" borderalpha="1" width="180" bordercolor="0x000000" wordwrap="1" enabled="1" height="20" borderradius="1" textcolor="0x000000" textalpha="1" border="1" backgroundalpha="1" backgroundcolor="0xffffff"/>\n                           <polystyle borderalpha="1" handcursor="1" mode="1" bordercolor="0x0000ff" backgroundalpha="0.2509803921568627" backgroundcolor="0x0000ff"/>';for(var l=0;l<e[n].jumpHotSpots.length;l++)t+='<hotspot skinid="ht_node" id="Point'+(l+1)+'" url="{'+e[n].jumpHotSpots[l].hotTarget.replace(/场景/,"node")+'}" pan="'+e[n].jumpHotSpots[l].panAndTilt[0]+'" target="0/0/0" tilt="'+e[n].jumpHotSpots[l].panAndTilt[1]+'" title="{'+e[n].jumpHotSpots[l].hotIntroduction+'}" jumpHotSpotsx="'+e[n].jumpHotSpots[l].position[0]+'" jumpHotSpotsy="'+e[n].jumpHotSpots[l].position[1]+'" jumpHotSpotsz="'+e[n].jumpHotSpots[l].position[2]+'" description=""/>';for(var c=0;c<e[n].urlHotSpots.length;c++){t+='<polyhotspot id="'+("hpimage"+n+c)+'" url="http://'+e[n].urlHotSpots[c].hotUrl+'" title="" description="" target="_blank">\n                              <vertex pan="'+e[n].urlHotSpots[c].panAndTilt[0][0]+'" tilt="'+e[n].urlHotSpots[c].panAndTilt[0][1]+'" urlHotSpotsx="'+e[n].urlHotSpots[c].position[0].x+'" urlHotSpotsy="'+e[n].urlHotSpots[c].position[0].y+'" urlHotSpotsz="'+e[n].urlHotSpots[c].position[0].z+'"/>\n                              <vertex pan="'+e[n].urlHotSpots[c].panAndTilt[1][0]+'" tilt="'+e[n].urlHotSpots[c].panAndTilt[1][1]+'" urlHotSpotsx="'+e[n].urlHotSpots[c].position[1].x+'" urlHotSpotsy="'+e[n].urlHotSpots[c].position[1].y+'" urlHotSpotsz="'+e[n].urlHotSpots[c].position[1].z+'"/>\n                              <vertex pan="'+e[n].urlHotSpots[c].panAndTilt[2][0]+'" tilt="'+e[n].urlHotSpots[c].panAndTilt[2][1]+'" urlHotSpotsx="'+e[n].urlHotSpots[c].position[2].x+'" urlHotSpotsy="'+e[n].urlHotSpots[c].position[2].y+'" urlHotSpotsz="'+e[n].urlHotSpots[c].position[2].z+'"/>\n                              <vertex pan="'+e[n].urlHotSpots[c].panAndTilt[3][0]+'" tilt="'+e[n].urlHotSpots[c].panAndTilt[3][1]+'" urlHotSpotsx="'+e[n].urlHotSpots[c].position[3].x+'" urlHotSpotsy="'+e[n].urlHotSpots[c].position[3].y+'" urlHotSpotsz="'+e[n].urlHotSpots[c].position[3].z+'"/>\n                             </polyhotspot>'}for(var p=0;p<e[n].imageHotSpots.length;p++)t+='<polyhotspot id="hpimage" url="" title="" description="" target="images/'+e[n].imageHotSpots[p].hotImage+'">\n                              <vertex pan="'+e[n].imageHotSpots[p].panAndTilt[0][0]+'" tilt="'+e[n].imageHotSpots[p].panAndTilt[0][1]+'" imageHotSpotsx="'+e[n].imageHotSpots[p].position[0].x+'" imageHotSpotsy="'+e[n].imageHotSpots[p].position[0].y+'" imageHotSpotsz="'+e[n].imageHotSpots[p].position[0].z+'"/>\n                              <vertex pan="'+e[n].imageHotSpots[p].panAndTilt[1][0]+'" tilt="'+e[n].imageHotSpots[p].panAndTilt[1][1]+'" imageHotSpotsx="'+e[n].imageHotSpots[p].position[1].x+'" imageHotSpotsy="'+e[n].imageHotSpots[p].position[1].y+'" imageHotSpotsz="'+e[n].imageHotSpots[p].position[1].z+'"/>\n                              <vertex pan="'+e[n].imageHotSpots[p].panAndTilt[2][0]+'" tilt="'+e[n].imageHotSpots[p].panAndTilt[2][1]+'" imageHotSpotsx="'+e[n].imageHotSpots[p].position[2].x+'" imageHotSpotsy="'+e[n].imageHotSpots[p].position[2].y+'" imageHotSpotsz="'+e[n].imageHotSpots[p].position[2].z+'"/>\n                              <vertex pan="'+e[n].imageHotSpots[p].panAndTilt[3][0]+'" tilt="'+e[n].imageHotSpots[p].panAndTilt[3][1]+'" imageHotSpotsx="'+e[n].imageHotSpots[p].position[3].x+'" imageHotSpotsy="'+e[n].imageHotSpots[p].position[3].y+'" imageHotSpotsz="'+e[n].imageHotSpots[p].position[3].z+'"/>\n                             </polyhotspot>';t+='</hotspots>\n                         <media/>\n                         <transition zoomin="0" zoomoutpause="1" enabled="0" blendcolor="0x000000" zoomspeed="2" type="crossdissolve" blendtime="1" softedge="0" zoomout="0" zoomfov="20"/>\n                         <control lockedmouse="0" speedwheel="1" dblclickfullscreen="0" hideabout="0" lockedkeyboard="0" invertwheel="0" invertcontrol="1" lockedkeyboardzoom="0" simulatemass="1" sensitivity="8" lockedwheel="0" contextfullscreen="0"/>\n                         </panorama>'}t+="</tour>",console.log(t);for(var u=[],h=[],d=0,m=this.$store.state.test.fileUrlArr.length;d<m;d++)u.push(this.$store.state.test.fileUrlArr[d].fileName),u.push(this.$store.state.test.fileUrlArr[d].fileUrl.replace(/http:\/\/172\.28\.211\.16:8010\//,""));for(var v=u.join(","),f=0,H=this.$store.state.test.tietu.length;f<H;f++)h.push(this.$store.state.test.tietu[f].fileName),h.push(this.$store.state.test.tietu[f].fileUrl);var g=h.join(",");this.$ajax({url:"/web/pano/html",method:"post",data:{_token:this.token,user:this.createUserNo,xmlstring:t,fastdfsURL:v,hotfastdfsURL:g,id:this.$store.state.test.viewNo},transformRequest:[function(t){var e="";for(var o in t)e+=encodeURIComponent(o)+"="+encodeURIComponent(t[o])+"&";return e}],headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}}).then(function(t){console.log(t)}).catch(function(t){console.log(t)}),this.$store.commit("createXmlString",t)},loadXMLDoc:function(t){var e=null;return(e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).open("GET",t,!1),e.send(),e.responseText}}},$={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-menu",{staticClass:"navbar",attrs:{mode:"horizontal"}},[o("el-submenu",{attrs:{index:"Elements"}},[o("template",{slot:"title"},[t._v("热点绘制")]),t._v(" "),o("el-menu-item",{attrs:{index:"Hotspot"},on:{click:t.drawHotspot}},[t._v("跳转热点")]),t._v(" "),o("el-menu-item",{attrs:{index:"imageHotspot"},on:{click:t.drawImageHotspot}},[t._v("图像热点")]),t._v(" "),o("el-menu-item",{attrs:{index:"imageHotspot"},on:{click:t.drawVideoHotspot}},[t._v("视频热点")])],2),t._v(" "),o("el-menu-item",{attrs:{index:"delete"},on:{click:t.deleteHotSpot}},[t._v("删除热点")]),t._v(" "),o("el-menu-item",{attrs:{index:"save"},on:{click:t.saveInformation}},[t._v("保存场景")]),t._v(" "),o("el-menu-item",{attrs:{index:"output"},on:{click:t.createXmlString}},[t._v("发布")]),t._v(" "),o("el-menu-item",{staticStyle:{display:"absolute",right:"-600px"},attrs:{index:"uerInfo"}},[t._v(t._s(t.userName))])],1)},staticRenderFns:[]};var x=o("VU/8")(R,$,!1,function(t){o("+uS9")},"data-v-89563d00",null).exports,M=o("mvHQ"),b=o.n(M),I={name:"SidebarItem",props:{routes:{type:Array}}},_={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[t._l(t.routes,function(e){return[!e.hidden&&e.noDropdown&&e.children.length>0?o("router-link",{attrs:{to:e.path+"/"+e.children[0].path}},[o("el-menu-item",{attrs:{index:e.path+"/"+e.children[0].path}},[e.icon?o("wscn-icon-svg",{attrs:{"icon-class":e.icon}}):t._e(),t._v(" "+t._s(e.children[0].name)+"\n            ")],1)],1):t._e(),t._v(" "),e.noDropdown||e.hidden?t._e():o("el-submenu",{attrs:{index:e.name}},[o("template",{slot:"title"},[e.icon?o("wscn-icon-svg",{attrs:{"icon-class":e.icon}}):t._e(),t._v(" "+t._s(e.name)+"\n            ")],1),t._v(" "),t._l(e.children,function(s){return s.hidden?t._e():[s.children&&s.children.length>0?o("sidebar-item",{staticClass:"menu-indent",attrs:{routes:[s]}}):o("router-link",{staticClass:"menu-indent",attrs:{to:e.path+"/"+s.path}},[o("el-menu-item",{attrs:{index:e.path+"/"+s.path}},[t._v("\n                        "+t._s(s.name)+"\n                    ")])],1)]})],2)]})],2)},staticRenderFns:[]};var F={components:{SidebarItem:o("VU/8")(I,_,!1,function(t){o("t30e")},"data-v-57085023",null).exports},computed:S()({},Object(l.b)(["permission_routers"]),{VideoRotate:{get:function(){return this.$store.state.test.videoRotate+"°"}},VideoScale:{get:function(){return this.$store.state.test.videoScale}},Scene:{get:function(){for(var t=0;t<this.$store.state.test.fileUrlArr.length;t++)if(this.$store.state.test.imgFile.fileName===this.$store.state.test.fileUrlArr[t].fileName)return t;return-1},set:function(){}},TempLocation:{get:function(){return this.$store.state.test.tempLocation}},imgFile:{get:function(){return this.$store.state.test.imgFile}},Tree:{get:function(){for(var t=[],e=0;e<this.$store.state.test.arr.length;e++){var o={label:"",children:[]},s={label:"跳转热点",children:[]},i={children:[]},n=this.$store.state.test.arr[e].hotspot.length;o.label="场景"+(e+1),o.pid=1;for(var a=0;a<n;a++){i={children:[]};var r={};r.label=this.$store.state.test.arr[e].hotspot[a].url.replace("{","").replace("}","").replace("node","场景"),r.pid=4,r.children=[],i.children.push(r),r.position=this.$store.state.test.arr[e].hotspot[a].position,(r={}).label=this.$store.state.test.arr[e].hotspot[a].title.replace("{","").replace("}",""),r.pid=5,r.children=[],i.children.push(r),i.label="跳转热点"+(a+1),i.pid=3,s.children.push(i)}s.pid=2,o.children.push(s),s={label:"图像热点",children:[]};for(var l=this.$store.state.test.arr[e].polyhotspot.imageHotSpots.length,c=0;c<l;c++){i={children:[]};var p={};p.label=this.$store.state.test.arr[e].polyhotspot.imageHotSpots[c].target.match(/([^/]+)$/)[1],p.pid=6,p.children=[],i.children.push(p),p.position=this.$store.state.test.arr[e].polyhotspot.imageHotSpots[c].position,p.panAndTilt=this.$store.state.test.arr[e].polyhotspot.imageHotSpots[c].panAndTilt,i.label="图像热点"+(c+1),i.pid=3,s.children.push(i)}s.pid=2,o.children.push(s),s={label:"URL热点",children:[]};for(var u=this.$store.state.test.arr[e].polyhotspot.urlHotSpots.length,h=0;h<u;h++){i={children:[]};var d={};d.label=this.$store.state.test.arr[e].polyhotspot.urlHotSpots[h].url.match(/([^/]+)$/)[1],d.pid=7,d.children=[],i.children.push(d),d.position=this.$store.state.test.arr[e].polyhotspot.urlHotSpots[h].position,d.panAndTilt=this.$store.state.test.arr[e].polyhotspot.urlHotSpots[h].panAndTilt,i.label="URL热点"+(h+1),i.pid=3,s.children.push(i)}s.pid=2,o.children.push(s),t.push(o)}for(var m=0,v=0;v<t.length;v++)t[v].id=++m;for(var f=0;f<t.length;f++)for(var H=0;H<t[f].children.length;H++)t[f].children[H].id=++m;for(var g=0;g<t.length;g++)for(var E=0;E<t[g].children.length;E++)for(var w=0;w<t[g].children[E].children.length;w++)t[g].children[E].children[w].id=++m;for(var S=0;S<t.length;S++)for(var T=0;T<t[S].children.length;T++)for(var y=0;y<t[S].children[T].children.length;y++)for(var R=0;R<t[S].children[T].children[y].children.length;R++)t[S].children[T].children[y].children[R].id=++m;return this.$store.commit("addMaxID",m),JSON.parse(b()(t))}},fileName:{get:function(){return this.$store.state.test.imgFile.fileName}},imgType:{get:function(){return this.$store.state.test.imgType},set:function(t){this.$store.commit("saveimgType",t)}},hotIntroduction:{get:function(){if(0!==f()(this.$store.state.test.tempLocation).length){for(var t=0;t<this.$store.state.test.jumpHotSpots.length;t++)if(Math.round(this.$store.state.test.jumpHotSpots[t].position[0])===Math.round(this.$store.state.test.tempLocation.location[0])&&Math.round(this.$store.state.test.jumpHotSpots[t].position[1])===Math.round(this.$store.state.test.tempLocation.location[1])&&Math.round(this.$store.state.test.jumpHotSpots[t].position[2])===Math.round(this.$store.state.test.tempLocation.location[2]))return this.$store.state.test.jumpHotSpots[t].hotIntroduction;return""}return""},set:function(){}},hotTarget:{get:function(){if(0!==f()(this.$store.state.test.tempLocation).length){for(var t=0;t<this.$store.state.test.jumpHotSpots.length;t++)if(Math.round(this.$store.state.test.jumpHotSpots[t].position[0])===Math.round(this.$store.state.test.tempLocation.location[0])&&Math.round(this.$store.state.test.jumpHotSpots[t].position[1])===Math.round(this.$store.state.test.tempLocation.location[1])&&Math.round(this.$store.state.test.jumpHotSpots[t].position[2])===Math.round(this.$store.state.test.tempLocation.location[2]))return this.$store.state.test.jumpHotSpots[t].hotTarget;return""}return""},set:function(){}},hotSpotsType:{get:function(){if(this.$store.state.test.selectHotType)return this.$store.state.test.selectHotType;if(0===f()(this.$store.state.test.tempLocation).length)return"";for(var t=0;t<this.$store.state.test.urlHotSpots.length;t++)if(Math.round(this.$store.state.test.urlHotSpots[t].position[0].x)===Math.round(this.$store.state.test.tempLocation.location[0].x)&&Math.round(this.$store.state.test.urlHotSpots[t].position[1].x)===Math.round(this.$store.state.test.tempLocation.location[1].x)&&Math.round(this.$store.state.test.urlHotSpots[t].position[2].x)===Math.round(this.$store.state.test.tempLocation.location[2].x)&&Math.round(this.$store.state.test.urlHotSpots[t].position[3].x)===Math.round(this.$store.state.test.tempLocation.location[3].x))return"URL热点";for(var e=0;e<this.$store.state.test.imageHotSpots.length;e++)if(Math.round(this.$store.state.test.imageHotSpots[e].position[0].x)===Math.round(this.$store.state.test.tempLocation.location[0].x)&&Math.round(this.$store.state.test.imageHotSpots[e].position[1].x)===Math.round(this.$store.state.test.tempLocation.location[1].x)&&Math.round(this.$store.state.test.imageHotSpots[e].position[2].x)===Math.round(this.$store.state.test.tempLocation.location[2].x)&&Math.round(this.$store.state.test.imageHotSpots[e].position[3].x)===Math.round(this.$store.state.test.tempLocation.location[3].x))return"图像热点"},set:function(){}},hotUrl:{get:function(){if(0!==f()(this.$store.state.test.tempLocation).length){for(var t=0;t<this.$store.state.test.urlHotSpots.length;t++)if(Math.round(this.$store.state.test.urlHotSpots[t].position[0].x)===Math.round(this.$store.state.test.tempLocation.location[0].x)&&Math.round(this.$store.state.test.urlHotSpots[t].position[0].y)===Math.round(this.$store.state.test.tempLocation.location[0].y)&&Math.round(this.$store.state.test.urlHotSpots[t].position[0].z)===Math.round(this.$store.state.test.tempLocation.location[0].z)&&Math.round(this.$store.state.test.urlHotSpots[t].position[1].x)===Math.round(this.$store.state.test.tempLocation.location[1].x)&&Math.round(this.$store.state.test.urlHotSpots[t].position[1].y)===Math.round(this.$store.state.test.tempLocation.location[1].y)&&Math.round(this.$store.state.test.urlHotSpots[t].position[1].z)===Math.round(this.$store.state.test.tempLocation.location[1].z)&&Math.round(this.$store.state.test.urlHotSpots[t].position[2].x)===Math.round(this.$store.state.test.tempLocation.location[2].x)&&Math.round(this.$store.state.test.urlHotSpots[t].position[2].y)===Math.round(this.$store.state.test.tempLocation.location[2].y)&&Math.round(this.$store.state.test.urlHotSpots[t].position[2].z)===Math.round(this.$store.state.test.tempLocation.location[2].z)&&Math.round(this.$store.state.test.urlHotSpots[t].position[3].x)===Math.round(this.$store.state.test.tempLocation.location[3].x)&&Math.round(this.$store.state.test.urlHotSpots[t].position[3].y)===Math.round(this.$store.state.test.tempLocation.location[3].y)&&Math.round(this.$store.state.test.urlHotSpots[t].position[3].z)===Math.round(this.$store.state.test.tempLocation.location[3].z))return this.$store.state.test.urlHotSpots[t]?this.$store.state.test.urlHotSpots[t].hotUrl:"";return""}return""},set:function(){}},hotSpotsImg:{get:function(){if(0!==f()(this.$store.state.test.tempLocation).length){for(var t=0;t<this.$store.state.test.imageHotSpots.length;t++)if(Math.round(this.$store.state.test.imageHotSpots[t].position[0].x)===Math.round(this.$store.state.test.tempLocation.location[0].x)&&Math.round(this.$store.state.test.imageHotSpots[t].position[0].y)===Math.round(this.$store.state.test.tempLocation.location[0].y)&&Math.round(this.$store.state.test.imageHotSpots[t].position[0].z)===Math.round(this.$store.state.test.tempLocation.location[0].z)&&Math.round(this.$store.state.test.imageHotSpots[t].position[1].x)===Math.round(this.$store.state.test.tempLocation.location[1].x)&&Math.round(this.$store.state.test.imageHotSpots[t].position[1].y)===Math.round(this.$store.state.test.tempLocation.location[1].y)&&Math.round(this.$store.state.test.imageHotSpots[t].position[1].z)===Math.round(this.$store.state.test.tempLocation.location[1].z)&&Math.round(this.$store.state.test.imageHotSpots[t].position[2].x)===Math.round(this.$store.state.test.tempLocation.location[2].x)&&Math.round(this.$store.state.test.imageHotSpots[t].position[2].y)===Math.round(this.$store.state.test.tempLocation.location[2].y)&&Math.round(this.$store.state.test.imageHotSpots[t].position[2].z)===Math.round(this.$store.state.test.tempLocation.location[2].z)&&Math.round(this.$store.state.test.imageHotSpots[t].position[3].x)===Math.round(this.$store.state.test.tempLocation.location[3].x)&&Math.round(this.$store.state.test.imageHotSpots[t].position[3].y)===Math.round(this.$store.state.test.tempLocation.location[3].y)&&Math.round(this.$store.state.test.imageHotSpots[t].position[3].z)===Math.round(this.$store.state.test.tempLocation.location[3].z))return this.$store.state.test.imageHotSpots[t]?this.$store.state.test.imageHotSpots[t].hotImage:"";return""}return""},set:function(){}},dateVal:{get:function(){return this.$store.state.test.dateVal},set:function(t){this.$store.commit("savedateVal",t)}},fileUrlArr:{get:function(){return this.$store.state.test.fileUrlArr}},targetOptions:{get:function(){for(var t=[{value:"无",label:"无"}],e=this.$store.state.test.fileUrlArr.length,o=0;o<e;o++){var s={};s.value="场景"+(o+1),s.label="场景"+(o+1),t.push(s)}return t}},ajaxUrl1:{get:function(){return this.$store.state.test.panoUploadUrl+"?_token="+this.token+"&user="+this.createUserNo+"&summary=1"}},ajaxUrl2:{get:function(){return this.$store.state.test.panoUploadUrl+"?_token="+this.token+"&user="+this.createUserNo+"&summary=2"}}}),watch:{TempLocation:function(){this.value="",this.value1="",this.value2=""}},methods:{selectGetX:function(t){this.Xvalue=t},selectGetY:function(t){this.Yvalue=t},selectGetR:function(t){this.Rvalue=t},selectGetS:function(t){this.Svalue=t},addTransformX:function(){console.log(this.Xvalue),this.$store.commit("changeOldSelectedX",this.Xvalue)},removeTransformX:function(){this.$store.commit("changeOldSelectedX",-1*this.Xvalue)},addTransformY:function(){this.$store.commit("changeOldSelectedY",-1*this.Yvalue)},removeTransformY:function(){this.$store.commit("changeOldSelectedY",this.Yvalue)},addRotate:function(){this.$store.commit("changeOldSelectedR",this.Rvalue)},removeRotate:function(){this.$store.commit("changeOldSelectedR",-1*this.Rvalue)},addScale:function(){this.$store.commit("changeOldSelectedS",this.Svalue)},removeScale:function(){this.$store.commit("changeOldSelectedS",-1*this.Svalue)},drawHotspot:function(t){"跳转热点"===t.label&&this.$store.dispatch("isHotspot"),"图像热点"!==t.label&&"URL热点"!==t.label||this.$store.dispatch("isImageHotspot")},saveTreeHotIntroduction:function(t){for(var e=this.$refs.input1[1].value,o=0;o<this.Tree.length;o++)for(var s=0;s<this.Tree[o].children.length;s++)for(var i=0;i<this.Tree[o].children[s].children.length;i++)for(var n=0;n<this.Tree[o].children[s].children[i].children.length;n++)this.Tree[o].children[s].children[i].children[n].id===t.id&&(this.$store.commit("saveTreeHotIntroduction",{i:o,j:s,k:i,l:n,result:e}),this.$store.commit("savehotIntroduction",{k:i,result:e}),this.$store.commit("showInactiveJumpSpot"))},saveTreeHotUrl:function(t){for(var e=this.$refs.input2[0].value,o=0;o<this.Tree.length;o++)for(var s=0;s<this.Tree[o].children.length;s++)for(var i=0;i<this.Tree[o].children[s].children.length;i++)for(var n=0;n<this.Tree[o].children[s].children[i].children.length;n++)this.Tree[o].children[s].children[i].children[n].id===t.id&&(this.$store.commit("saveTreeHotUrl",{i:o,j:s,k:i,l:n,result:e}),this.$store.commit("savehotUrl",{k:i,result:e}),this.$store.commit("showInactiveUrlSpot"))},saveTreeJumpScene:function(t){for(var e=t.label,o=0;o<this.Tree.length;o++)for(var s=0;s<this.Tree[o].children.length;s++)for(var i=0;i<this.Tree[o].children[s].children.length;i++)for(var n=0;n<this.Tree[o].children[s].children[i].children.length;n++)this.Tree[o].children[s].children[i].children[n].id===t.id&&(this.$store.commit("saveTreeJumpScene",{i:o,j:s,k:i,l:n,result:e}),this.$store.commit("savehotTarget",{k:i,result:e}),this.$store.commit("showInactiveJumpSpot"))},saveTreeUploadPicture:function(t){for(var e=t.label,o=0;o<this.Tree.length;o++)for(var s=0;s<this.Tree[o].children.length;s++)for(var i=0;i<this.Tree[o].children[s].children.length;i++)for(var n=0;n<this.Tree[o].children[s].children[i].children.length;n++)this.Tree[o].children[s].children[i].children[n].id===t.id&&(this.$store.commit("saveTreeUploadPicture",{i:o,j:s,k:i,l:n,result:e}),this.$store.commit("savehotImage",{k:i,result:e}),this.$store.commit("showInactiveImageSpot"))},saveSelectHotType:function(t){this.$store.commit("saveSelectHotType",t)},saveSelectUploadPicture:function(t){this.$store.commit("saveSelectUploadPicture",t)},saveSelectJumpScene:function(t){this.$store.commit("saveSelectJumpScene",t)},saveInputHotIntroduction:function(){this.$store.commit("saveInputHotIntroduction",this.$refs.input3.$refs.input.value)},saveInputHotUrl:function(){this.$store.commit("saveInputHotUrl",this.$refs.input4.$refs.input.value)},newDeleteHotSpot:function(t,e){4===t.children[0].pid&&this.$store.commit("deleteJumpHotSpot",{scene:this.Scene,index:e}),6===t.children[0].pid&&this.$store.commit("deleteImageHotSpot",{scene:this.Scene,index:e}),7===t.children[0].pid&&this.$store.commit("deleteUrlHotSpot",{scene:this.Scene,index:e}),this.$store.commit("newDeleteHotSpot",{position:t.children[0].position,pid:t.children[0].pid})},expand:function(t){this.expandicon!==t.target.parentNode.parentNode.querySelector(".custom-tree-node span").innerText?this.expandicon=t.target.parentNode.parentNode.querySelector(".custom-tree-node span").innerText:this.expandicon=-1},expand1:function(t){this.expandicon1!==t.target.parentNode.parentNode.querySelector(".custom-tree-node span").innerText?this.expandicon1=t.target.parentNode.parentNode.querySelector(".custom-tree-node span").innerText:this.expandicon1=-1},expand2:function(t){this.expandicon2!==t.target.parentNode.parentNode.querySelector(".custom-tree-node span").innerText?this.expandicon2=t.target.parentNode.parentNode.querySelector(".custom-tree-node span").innerText:this.expandicon2=-1},newChangeImgFile:function(t){for(var e=0;e<this.Tree.length;e++)if(t.label===this.Tree[e].label){var o=this.$store.state.test.fileUrlArr[e].fileName,s=this.$store.state.test.fileUrlArr[e].fileUrl;this.$store.commit("saveimgFile",{fileName:o,fileUrl:[s]})}},activeHotSpot:function(t){4===t.children[0].pid&&this.$store.commit("showActiveJumpSpot",t),6===t.children[0].pid&&this.$store.commit("showActiveImageSpot",t),7===t.children[0].pid&&this.$store.commit("showActiveUrlSpot",t)},deleteScene:function(t,e){this.$store.commit("deleteScene",e)},changeImgFile:function(t){var e=t.target.getAttribute("src"),o=t.target.getAttribute("title");this.$store.commit("saveimgFile",{fileName:o,fileUrl:[e]})},panoUploadSuccess:function(t,e,o){console.log("上传全景文件",t);var s=this;s.$ajax({url:"/web/file/1/"+s.$store.state.test.viewNo,method:"get",params:{summary:1},headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}}).then(function(t){var e=t.data.data,o=[],i=!0,n=!1,a=void 0;try{for(var r,l=m()(e);!(i=(r=l.next()).done);i=!0){var c=r.value,p={};p.fileName=c.name,p.fileUrl="http://172.28.211.16:8010/"+c.url,o.push(p)}}catch(t){n=!0,a=t}finally{try{!i&&l.return&&l.return()}finally{if(n)throw a}}s.$store.commit("saveFileUrlArr",o)}).catch(function(t){console.log(t)})},imgUploadSuccess:function(t,e,o){console.log("上传图片文件",t);var s=this;s.$ajax({url:"/web/file/1/"+s.$store.state.test.viewNo,method:"get",params:{summary:2},headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}}).then(function(t){var e=t.data.data;console.log("已上传的贴图",e);var o=[],i=[],n=!0,a=!1,r=void 0;try{for(var l,c=m()(e);!(n=(l=c.next()).done);n=!0){var p=l.value,u={};u.key=p.name,u.value=p.name,o.push(u);var h={};h.fileName=p.name,h.fileUrl=p.url,i.push(h)}}catch(t){a=!0,r=t}finally{try{!n&&c.return&&c.return()}finally{if(a)throw r}}s.$store.commit("saveHotSpotsImgs",o),s.$store.commit("saveTietu",i)}).catch(function(t){console.log(t)})},uploadError:function(t,e,o){alert("上传失败，请重试！")},beforeRemove:function(t,e){return this.$confirm("确定移除 "+t.name+"？")},panoHandleRemove:function(t,e){for(var o=t.name,s=this.$store.state.test.fileUrlArr,i=0,n=s.length;i<n;i++)s[i].fileName==o&&s.splice(i,1);this.$store.commit("saveFileUrlArr",s)},imgHandleRemove:function(t,e){for(var o=t.name,s=this.$store.state.test.hotSpotsImg,i=0,n=s.length;i<n;i++)s[i].value==o&&s.splice(i,1);this.$store.commit("saveFileUrlArr",s)},saveJumpHotSpot:function(){if(this.$store.state.test.selectJumpScene&&this.$store.state.test.inputHotIntroduction){this.value2="";for(var t=!1,e=-1,o=0;o<this.$store.state.test.jumpHotSpots.length;o++)Math.round(this.$store.state.test.jumpHotSpots[o].position[0])===Math.round(this.$store.state.test.tempLocation.location[0])&&Math.round(this.$store.state.test.jumpHotSpots[o].position[1])===Math.round(this.$store.state.test.tempLocation.location[1])&&Math.round(this.$store.state.test.jumpHotSpots[o].position[2])===Math.round(this.$store.state.test.tempLocation.location[2])&&(t=!0,e=o);t?(this.$store.commit("changeJumpHotSpot",{index:e,hotTarget:this.$store.state.test.selectJumpScene,hotIntroduction:this.$store.state.test.inputHotIntroduction}),this.$store.commit("changeTreeJumpHotSpot",{scene:this.Scene,index:e,hotTarget:this.$store.state.test.selectJumpScene,hotIntroduction:this.$store.state.test.inputHotIntroduction})):(this.$store.commit("saveJumpHotSpot",{hotTarget:this.$store.state.test.selectJumpScene,hotIntroduction:this.$store.state.test.inputHotIntroduction}),this.$store.commit("saveTreeJumpHotSpot",{scene:this.Scene,hotTarget:this.$store.state.test.selectJumpScene,hotIntroduction:this.$store.state.test.inputHotIntroduction})),this.$store.commit("hideHotSpot")}else alert("请添加跳转场景和者热点说明！")},saveUrlHotSpot:function(){if("URL热点"===this.$store.state.test.selectHotType)if(this.$store.state.test.inputHotUrl&&this.$store.state.test.selectHotType){this.value1="",this.value="";for(var t=!1,e=-1,o=0;o<this.$store.state.test.urlHotSpots.length;o++)Math.round(this.$store.state.test.urlHotSpots[o].position[0].x)===Math.round(this.$store.state.test.tempLocation.location[0].x)&&Math.round(this.$store.state.test.urlHotSpots[o].position[0].y)===Math.round(this.$store.state.test.tempLocation.location[0].y)&&Math.round(this.$store.state.test.urlHotSpots[o].position[0].z)===Math.round(this.$store.state.test.tempLocation.location[0].z)&&Math.round(this.$store.state.test.urlHotSpots[o].position[1].x)===Math.round(this.$store.state.test.tempLocation.location[1].x)&&Math.round(this.$store.state.test.urlHotSpots[o].position[1].y)===Math.round(this.$store.state.test.tempLocation.location[1].y)&&Math.round(this.$store.state.test.urlHotSpots[o].position[1].z)===Math.round(this.$store.state.test.tempLocation.location[1].z)&&Math.round(this.$store.state.test.urlHotSpots[o].position[2].x)===Math.round(this.$store.state.test.tempLocation.location[2].x)&&Math.round(this.$store.state.test.urlHotSpots[o].position[2].y)===Math.round(this.$store.state.test.tempLocation.location[2].y)&&Math.round(this.$store.state.test.urlHotSpots[o].position[2].z)===Math.round(this.$store.state.test.tempLocation.location[2].z)&&Math.round(this.$store.state.test.urlHotSpots[o].position[3].x)===Math.round(this.$store.state.test.tempLocation.location[3].x)&&Math.round(this.$store.state.test.urlHotSpots[o].position[3].y)===Math.round(this.$store.state.test.tempLocation.location[3].y)&&Math.round(this.$store.state.test.urlHotSpots[o].position[3].z)===Math.round(this.$store.state.test.tempLocation.location[3].z)&&(t=!0,e=o);t?(this.$store.commit("changeUrlHotSpot",{index:e,hotUrl:this.$store.state.test.inputHotUrl}),this.$store.commit("changeTreeUrlHotSpot",{scene:this.Scene,index:e,hotUrl:this.$store.state.test.inputHotUrl})):(this.$store.commit("saveUrlHotSpot",{hotUrl:this.$store.state.test.inputHotUrl}),this.$store.commit("saveTreeUrlHotSpot",{scene:this.Scene,hotUrl:this.$store.state.test.inputHotUrl})),this.$store.commit("hideHotSpot")}else alert("请确定热点类型和跳转链接！")},saveImageHotSpot:function(){if("图像热点"===this.$store.state.test.selectHotType)if(this.$store.state.test.selectUploadPicture&&this.$store.state.test.selectHotType){this.value1="",this.value="";for(var t=!1,e=-1,o=0;o<this.$store.state.test.imageHotSpots.length;o++)Math.round(this.$store.state.test.imageHotSpots[o].position[0].x)===Math.round(this.$store.state.test.tempLocation.location[0].x)&&Math.round(this.$store.state.test.imageHotSpots[o].position[0].y)===Math.round(this.$store.state.test.tempLocation.location[0].y)&&Math.round(this.$store.state.test.imageHotSpots[o].position[0].z)===Math.round(this.$store.state.test.tempLocation.location[0].z)&&Math.round(this.$store.state.test.imageHotSpots[o].position[1].x)===Math.round(this.$store.state.test.tempLocation.location[1].x)&&Math.round(this.$store.state.test.imageHotSpots[o].position[1].y)===Math.round(this.$store.state.test.tempLocation.location[1].y)&&Math.round(this.$store.state.test.imageHotSpots[o].position[1].z)===Math.round(this.$store.state.test.tempLocation.location[1].z)&&Math.round(this.$store.state.test.imageHotSpots[o].position[2].x)===Math.round(this.$store.state.test.tempLocation.location[2].x)&&Math.round(this.$store.state.test.imageHotSpots[o].position[2].y)===Math.round(this.$store.state.test.tempLocation.location[2].y)&&Math.round(this.$store.state.test.imageHotSpots[o].position[2].z)===Math.round(this.$store.state.test.tempLocation.location[2].z)&&Math.round(this.$store.state.test.imageHotSpots[o].position[3].x)===Math.round(this.$store.state.test.tempLocation.location[3].x)&&Math.round(this.$store.state.test.imageHotSpots[o].position[3].y)===Math.round(this.$store.state.test.tempLocation.location[3].y)&&Math.round(this.$store.state.test.imageHotSpots[o].position[3].z)===Math.round(this.$store.state.test.tempLocation.location[3].z)&&(t=!0,e=o);t?(this.$store.commit("changeImageHotSpot",{index:e,hotImage:this.$store.state.test.selectUploadPicture}),this.$store.commit("changeTreeImageHotSpot",{scene:this.Scene,index:e,hotImage:this.$store.state.test.selectUploadPicture})):(this.$store.commit("saveImageHotSpot",{hotImage:this.$store.state.test.selectUploadPicture}),this.$store.commit("saveTreeImageHotSpot",{scene:this.Scene,hotImage:this.$store.state.test.selectUploadPicture})),this.$store.commit("hideHotSpot")}else alert("请确定热点类型和已上传图片！")}},data:function(){return{defaultTarget:"",hotSpotsTypes:[{key:"URL热点",value:"URL热点"},{key:"图像热点",value:"图像热点"}],createUserNo:"84d2a1ed-d26e-4772-a296-ce8c111132d4",companyNo:"84d2a1ed-d26e-4772-a296-ce8c111132d4",token:"4KD8DLL84D2A1ED-D26E-4772-A296-CE8C111132D4",pickerOptions0:{disabledDate:function(t){return t.getTime()<Date.now()-864e5}},hotSpotsImgs:[{key:"tianyu01.jpg",value:"tianyu01.jpg",label:"tianyu01.jpg"},{key:"tianyu02.jpg",value:"tianyu02.jpg",label:"tianyu02.jpg"}],value:"",value1:"",value2:"",expandicon:-1,expandicon1:-1,expandicon2:-1,dialogFormVisible:!1,formLabelWidth:"120px",optionsX:[{value:"1",label:"×1"},{value:"10",label:"×10"},{value:"100",label:"×100"}],Xvalue:1,valueX:"1",optionsY:[{value:"1",label:"×1"},{value:"10",label:"×10"},{value:"100",label:"×100"}],Yvalue:1,valueY:"1",optionsR:[{value:"1",label:"×1°"},{value:"10",label:"×10°"}],Rvalue:1,valueR:"1",optionsS:[{value:"0.1",label:"0.1"},{value:"0.5",label:"0.5"}],Svalue:.1,valueS:"0.1"}}},z={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-menu",{attrs:{mode:"vertical","default-active":t.$route.path}},[o("div",{staticClass:"sidelogo"},[o("span",[o("i",{staticClass:"el-icon-setting"})]),t._v(" "),o("span",{staticClass:"sidelogotxt"},[t._v("  全景编辑")])]),t._v(" "),o("el-tabs",{attrs:{type:"border-card"}},[o("el-button",{staticStyle:{width:"266px"},attrs:{type:"primary"},on:{click:function(e){t.dialogFormVisible=!0}}},[t._v("\n        添加场景"),o("i",{staticClass:"el-icon-plus"})]),t._v(" "),o("el-dialog",{attrs:{title:"全景图片:",visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[o("el-form",[o("el-form-item",{attrs:{label:"上传","label-width":t.formLabelWidth}},[o("el-upload",{staticClass:"upload-panorama1",attrs:{action:t.ajaxUrl1,"on-remove":t.panoHandleRemove,"before-remove":t.beforeRemove,onError:t.uploadError,onSuccess:t.panoUploadSuccess}},[o("el-button",{attrs:{size:"small",type:"primary"}},[t._v("请上传全景照片")])],1)],1),t._v(" "),o("el-form-item",{attrs:{label:"类型","label-width":t.formLabelWidth}},[o("el-select",{attrs:{size:"small"},model:{value:t.imgType,callback:function(e){t.imgType=e},expression:"imgType"}},[o("el-option",{attrs:{label:"Auto",value:"Auto"}}),t._v(" "),o("el-option",{attrs:{label:"Equirectangular",value:"Equirectangular"}}),t._v(" "),o("el-option",{attrs:{label:"Cube Faces",value:"Cube Faces"}}),t._v(" "),o("el-option",{attrs:{label:"Cylindrical",value:"Cylindrical"}}),t._v(" "),o("el-option",{attrs:{label:"Flat",value:"Flat"}})],1)],1),t._v(" "),o("el-form-item",{attrs:{label:"文件名","label-width":t.formLabelWidth}},[o("el-input",{staticStyle:{width:"200px"},attrs:{size:"small",id:"image",disabled:!0},model:{value:t.fileName,callback:function(e){t.fileName=e},expression:"fileName"}})],1)],1),t._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取 消")]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("确 定")])],1)],1),t._v(" "),o("div"),t._v(" "),o("div"),t._v(" "),o("div"),t._v(" "),o("el-form",{attrs:{"label-position":"left","label-width":"100px"}},[o("div",{staticClass:"sideItem"},[o("div",{directives:[{name:"show",rawName:"v-show",value:this.$store.state.test.isImgHotSpot,expression:"this.$store.state.test.isImgHotSpot"}]},[o("div",{staticClass:"sidetitle"},[t._v("热点类型:")]),t._v(" "),o("el-form-item",{attrs:{label:"热点类型"}},[o("el-select",{attrs:{size:"small",clearable:"",placeholder:t.hotSpotsType?t.hotSpotsType:"请选择热点类型"},on:{change:function(e){t.saveSelectHotType(t.value)}},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}},t._l(t.hotSpotsTypes,function(t){return o("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:"URL热点"===this.hotSpotsType,expression:"this.hotSpotsType==='URL热点'"}]},[o("el-form-item",{attrs:{label:"跳转链接"}},[o("el-input",{ref:"input4",attrs:{value:t.hotUrl,clearable:"",placeholder:"确认后点击确定"},on:{blur:function(e){e.preventDefault(),t.saveInputHotUrl()}}})],1),t._v(" "),o("div",{staticStyle:{"text-align":"center"}},[o("el-button",{attrs:{type:"primary"},on:{click:t.saveUrlHotSpot}},[t._v("确定")])],1)],1),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:"图像热点"===this.hotSpotsType,expression:"this.hotSpotsType==='图像热点'"}]},[o("el-form-item",{attrs:{label:"已上传图片"}},[o("el-select",{attrs:{size:"small",clearable:"",placeholder:t.hotSpotsImg?t.hotSpotsImg:"请选择已上传图片"},on:{change:function(e){t.saveSelectUploadPicture(t.value1)}},model:{value:t.value1,callback:function(e){t.value1=e},expression:"value1"}},t._l(this.$store.state.test.hotSpotsImgs,function(t){return o("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),o("el-form-item",{attrs:{label:"图片上传"}},[o("el-upload",{staticClass:"upload-panorama1",attrs:{action:t.ajaxUrl2,"on-remove":t.imgHandleRemove,"before-remove":t.beforeRemove,onError:t.uploadError,onSuccess:t.imgUploadSuccess}},[o("el-button",{attrs:{size:"small",type:"primary"}},[t._v("请上传热点图片")])],1)],1),t._v(" "),o("div",{staticStyle:{"text-align":"center"}},[o("el-button",{attrs:{type:"primary"},on:{click:t.saveImageHotSpot}},[t._v("确定")])],1)],1)],1),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:this.$store.state.test.isJumpHotSpot,expression:"this.$store.state.test.isJumpHotSpot"}]},[o("div",{staticClass:"sidetitle"},[t._v("跳转热点:")]),t._v(" "),o("el-form-item",{attrs:{label:"目标场景"}},[o("el-select",{attrs:{size:"small",clearable:"",placeholder:t.hotTarget?t.hotTarget:"请选择要跳转的场景"},on:{change:function(e){t.saveSelectJumpScene(t.value2)}},model:{value:t.value2,callback:function(e){t.value2=e},expression:"value2"}},t._l(t.targetOptions,function(t){return o("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),o("el-form-item",{attrs:{label:"场景说明"}},[o("el-input",{ref:"input3",attrs:{value:t.hotIntroduction,clearable:"",placeholder:"确认后点击确定"},on:{blur:function(e){e.preventDefault(),t.saveInputHotIntroduction()}}})],1),t._v(" "),o("div",{staticStyle:{"text-align":"center"}},[o("el-button",{attrs:{type:"primary"},on:{click:t.saveJumpHotSpot}},[t._v("确定")])],1)],1),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:this.$store.state.test.isVideoHotSpot,expression:"this.$store.state.test.isVideoHotSpot"}]},[o("div",{staticClass:"sidetitle"},[t._v("热点类型:")]),t._v(" "),o("el-form-item",{attrs:{label:"上传视频类型"}},[o("el-select",{attrs:{size:"small",clearable:"",placeholder:t.hotSpotsType?t.hotSpotsType:"请选择视频类型"},on:{change:function(e){t.saveSelectHotType(t.value)}},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}},t._l(t.hotSpotsTypes,function(t){return o("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),o("div",{staticClass:"transfrom"},[o("label",[t._v("水平平移：")]),t._v(" "),o("el-select",{attrs:{placeholder:"请选择",id:"txtNumberX"},on:{change:function(e){t.selectGetX(t.valueX)}},model:{value:t.valueX,callback:function(e){t.valueX=e},expression:"valueX"}},t._l(t.optionsX,function(t){return o("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),t._v(" "),o("i",{staticClass:"el-icon-arrow-up up",on:{click:function(e){e.stopPropagation(),t.addTransformX()}}}),t._v(" "),o("i",{staticClass:"el-icon-arrow-down down",on:{click:function(e){e.stopPropagation(),t.removeTransformX()}}})],1),t._v(" "),o("div",{staticClass:"transfrom"},[o("label",[t._v("竖直平移：")]),t._v(" "),o("el-select",{attrs:{placeholder:"请选择",id:"txtNumberY"},on:{change:function(e){t.selectGetY(t.valueY)}},model:{value:t.valueY,callback:function(e){t.valueY=e},expression:"valueY"}},t._l(t.optionsY,function(t){return o("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),t._v(" "),o("i",{staticClass:"el-icon-arrow-up up",on:{click:function(e){e.stopPropagation(),t.addTransformY()}}}),t._v(" "),o("i",{staticClass:"el-icon-arrow-down down",on:{click:function(e){e.stopPropagation(),t.removeTransformY()}}})],1),t._v(" "),o("div",{staticClass:"transfrom"},[o("label",[t._v("旋转：")]),t._v(" "),o("el-select",{attrs:{placeholder:"请选择",id:"txtNumberRR"},on:{change:function(e){t.selectGetR(t.valueR)}},model:{value:t.valueR,callback:function(e){t.valueR=e},expression:"valueR"}},t._l(t.optionsR,function(t){return o("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),t._v(" "),o("i",{staticClass:"el-icon-arrow-up up",on:{click:function(e){e.stopPropagation(),t.addRotate()}}}),t._v(" "),o("i",{staticClass:"el-icon-arrow-down down",on:{click:function(e){e.stopPropagation(),t.removeRotate()}}})],1),t._v(" "),o("div",{staticClass:"transfrom"},[o("label",[t._v("放缩：")]),t._v(" "),o("el-select",{attrs:{placeholder:"请选择",id:"txtNumberSS"},on:{change:function(e){t.selectGetS(t.valueS)}},model:{value:t.valueS,callback:function(e){t.valueS=e},expression:"valueS"}},t._l(t.optionsS,function(t){return o("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),t._v(" "),o("i",{staticClass:"el-icon-arrow-up up",on:{click:function(e){e.stopPropagation(),t.addScale()}}}),t._v(" "),o("i",{staticClass:"el-icon-arrow-down down",on:{click:function(e){e.stopPropagation(),t.removeScale()}}})],1),t._v(" "),o("div",{staticClass:"transfrom"},[o("label",[t._v("旋转角度：")]),t._v(" "),o("input",{directives:[{name:"model",rawName:"v-model",value:t.VideoRotate,expression:"VideoRotate"}],attrs:{type:"text",id:"txtNumberR",disabled:!0},domProps:{value:t.VideoRotate},on:{input:function(e){e.target.composing||(t.VideoRotate=e.target.value)}}})]),t._v(" "),o("div",{staticClass:"transfrom"},[o("label",[t._v("放缩倍数：")]),t._v(" "),o("input",{directives:[{name:"model",rawName:"v-model",value:t.VideoScale,expression:"VideoScale"}],attrs:{type:"text",id:"txtNumberS",disabled:!0},domProps:{value:t.VideoScale},on:{input:function(e){e.target.composing||(t.VideoScale=e.target.value)}}})]),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:"URL热点"===this.hotSpotsType,expression:"this.hotSpotsType==='URL热点'"}]},[o("el-form-item",{attrs:{label:"视频链接"}},[o("el-input",{ref:"input4",attrs:{value:t.hotUrl,clearable:"",placeholder:"确认后点击确定"},on:{blur:function(e){e.preventDefault(),t.saveInputHotUrl()}}})],1),t._v(" "),o("div",{staticStyle:{"text-align":"center"}},[o("el-button",{attrs:{type:"primary"},on:{click:t.saveUrlHotSpot}},[t._v("确定")])],1)],1),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:"图像热点"===this.hotSpotsType,expression:"this.hotSpotsType==='图像热点'"}]},[o("el-form-item",{attrs:{label:"本地视频"}},[o("el-select",{attrs:{size:"small",clearable:"",placeholder:t.hotSpotsImg?t.hotSpotsImg:"请选择已上传视频"},on:{change:function(e){t.saveSelectUploadPicture(t.value1)}},model:{value:t.value1,callback:function(e){t.value1=e},expression:"value1"}},t._l(this.$store.state.test.hotSpotsImgs,function(t){return o("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),o("el-form-item",{attrs:{label:"视频上传"}},[o("el-upload",{staticClass:"upload-panorama1",attrs:{action:t.ajaxUrl2,"on-remove":t.imgHandleRemove,"before-remove":t.beforeRemove,onError:t.uploadError,onSuccess:t.imgUploadSuccess}},[o("el-button",{attrs:{size:"small",type:"primary"}},[t._v("请上传相关视频")])],1)],1),t._v(" "),o("div",{staticStyle:{"text-align":"center"}},[o("el-button",{attrs:{type:"primary"},on:{click:function(t){}}},[t._v("确定")])],1)],1)],1)])]),t._v(" "),o("div",{staticClass:"tree"},[o("div",{staticClass:"el-tree"},t._l(t.Tree,function(e,s){return o("div",{staticClass:"el-tree-node"},[o("div",{staticClass:"el-tree-node__content",staticStyle:{"padding-left":"0px"}},[o("span",{on:{click:function(e){return e.stopPropagation(),t.expand(e)}}},[t.expandicon===e.label?o("span",{staticClass:"el-tree-node__expand-icon expanded"}):o("span",{staticClass:"el-tree-node__expand-icon "})]),t._v(" "),o("span",{staticClass:"custom-tree-node"},[o("span",[t._v(t._s(e.label))]),t._v(" "),o("span",[o("i",{staticClass:"el-icon-search",on:{click:function(o){o.stopPropagation(),t.newChangeImgFile(e)}}}),t._v(" "),o("i",{staticClass:"el-icon-delete",on:{click:function(o){o.stopPropagation(),t.deleteScene(e,s)}}})])])]),t._v(" "),t.expandicon===e.label?o("div",[o("div",{staticClass:"el-tree-node__children",staticStyle:{display:"block"}},t._l(t.Tree[s].children,function(e,s){return o("div",{staticClass:"el-tree-node"},[o("div",{staticClass:"el-tree-node__content",staticStyle:{"padding-left":"16px"}},[o("span",{on:{click:function(e){return e.stopPropagation(),t.expand1(e)}}},[t.expandicon1===e.label?o("span",{staticClass:"el-tree-node__expand-icon expanded"}):o("span",{staticClass:"el-tree-node__expand-icon"})]),t._v(" "),o("span",{staticClass:"custom-tree-node"},[o("span",[t._v(t._s(e.label))]),t._v(" "),o("span",[o("i",{staticClass:"el-icon-plus",on:{click:function(o){o.stopPropagation(),t.drawHotspot(e)}}})])])]),t._v(" "),t.expandicon1===e.label?o("div",[o("div",{staticClass:"el-tree-node__children",staticStyle:{display:"block"}},t._l(e.children,function(e,s){return o("div",{staticClass:"el-tree-node"},[o("div",{staticClass:"el-tree-node__content",staticStyle:{"padding-left":"32px"},on:{click:function(o){o.stopPropagation(),t.activeHotSpot(e)}}},[o("span",{on:{click:function(e){return e.stopPropagation(),t.expand2(e)}}},[t.expandicon2===e.label?o("span",{staticClass:"el-tree-node__expand-icon expanded"}):o("span",{staticClass:"el-tree-node__expand-icon"})]),t._v(" "),o("span",{staticClass:"custom-tree-node"},[o("span",[t._v(t._s(e.label))]),t._v(" "),o("span",[o("i",{staticClass:"el-icon-delete",on:{click:function(o){o.stopPropagation(),t.newDeleteHotSpot(e,s)}}})])])]),t._v(" "),o("div",[t.expandicon2===e.label?o("div",[o("div",{staticClass:"el-tree-node__children",staticStyle:{display:"block"}},t._l(e.children,function(e){return o("div",{staticClass:"el-tree-node"},[o("div",{staticClass:"el-tree-node__content",staticStyle:{"padding-left":"48px"}},[o("span",{staticClass:"el-tree-node__expand-icon is-leaf"}),t._v(" "),o("span",{staticClass:"custom-tree-node"},[o("span",{directives:[{name:"show",rawName:"v-show",value:4===e.pid,expression:"child2.pid===4"}]},[t._v("\n                                    跳转场景：\n                                    "),[o("select",{directives:[{name:"model",rawName:"v-model",value:e.label,expression:"child2.label"}],on:{change:[function(o){var s=Array.prototype.filter.call(o.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(e,"label",o.target.multiple?s:s[0])},function(o){t.saveTreeJumpScene(e)}]}},[o("option",{attrs:{disabled:"",value:""}},[t._v(t._s(e.label))]),t._v(" "),t._l(t.targetOptions,function(e){return o("option",{domProps:{value:e.value}},[t._v("\n                                         "+t._s(e.value)+"\n                                       ")])})],2)]],2),t._v(" "),o("span",{directives:[{name:"show",rawName:"v-show",value:5===e.pid,expression:"child2.pid===5"}]},[t._v("\n                                热点说明："),o("input",{ref:"input1",refInFor:!0,domProps:{value:e.label},on:{blur:function(o){o.preventDefault(),t.saveTreeHotIntroduction(e)}}})]),t._v(" "),o("span",{directives:[{name:"show",rawName:"v-show",value:6===e.pid,expression:"child2.pid===6"}]},[t._v("\n                                    已上传图片：\n                                    "),[o("select",{directives:[{name:"model",rawName:"v-model",value:e.label,expression:"child2.label"}],on:{change:[function(o){var s=Array.prototype.filter.call(o.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(e,"label",o.target.multiple?s:s[0])},function(o){t.saveTreeUploadPicture(e)}]}},[o("option",{attrs:{disabled:"",value:""}},[t._v(t._s(e.label))]),t._v(" "),t._l(t.hotSpotsImgs,function(e){return o("option",{domProps:{value:e.value}},[t._v("\n                                      "+t._s(e.value)+"\n                                    ")])})],2)]],2),t._v(" "),o("span",{directives:[{name:"show",rawName:"v-show",value:7===e.pid,expression:"child2.pid===7"}]},[t._v("\n                                跳转链接："),o("input",{ref:"input2",refInFor:!0,domProps:{value:e.label},on:{blur:function(o){o.preventDefault(),t.saveTreeHotUrl(e)}}})])])]),t._v(" "),o("div",{staticClass:"el-tree-node__children",staticStyle:{display:"none"}})])}))]):o("div",[o("div",{staticClass:"el-tree-node__children",staticStyle:{display:"none"}})])])])}))]):o("div",[o("div",{staticClass:"el-tree-node__children",staticStyle:{display:"none"}})])])}))]):o("div",[o("div",{staticClass:"el-tree-node__children",staticStyle:{display:"none"}})])])}))]),t._v(" "),o("el-form",{attrs:{"label-position":"left","label-width":"100px"}},[o("div",{staticClass:"sideItem"},[o("div",{staticClass:"sidetitle"},[t._v("场景预览:")]),t._v(" "),o("el-form",{attrs:{"label-position":"left","label-width":"150px"}},[o("div",{staticClass:"sideItem"},[o("ul",{staticStyle:{padding:"0"}},[o("img",{attrs:{src:t.imgFile.fileUrl,title:t.imgFile.fileName,width:"270px",height:"135px"}})])])])],1)]),t._v(" "),o("div")],1)],1)},staticRenderFns:[]};var U=o("VU/8")(F,z,!1,function(t){o("ODC6")},"data-v-7df9d509",null).exports,L={name:"AppMain",components:{editor:o("tyP1").default}},V={render:function(){var t=this.$createElement;return(this._self._c||t)("editor",{staticClass:"app-main",staticStyle:{"min-height":"100%"}})},staticRenderFns:[]},C={name:"layout",components:{Navbar:x,Sidebar:U,AppMain:o("VU/8")(L,V,!1,null,null,null).exports},computed:{sidebar:function(){return this.$store.state.app.sidebar}}},j={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"app-wrapper",class:{hideSidebar:!this.sidebar.opened}},[e("div",{staticClass:"sidebar-wrapper"},[e("Sidebar",{staticClass:"sidebar-container"})],1),this._v(" "),e("div",{staticClass:"main-container"},[e("Navbar"),this._v(" "),e("App-main")],1)])},staticRenderFns:[]};var P=o("VU/8")(C,j,!1,function(t){o("LLNR")},"data-v-20c043af",null).exports;n.a.use(E.a);var N=[{path:"/editor",component:P,redirect:"/editor/index",hidden:!0,icon:"xinrenzhinan",noDropdown:!0,children:[{path:"index",component:function(){return new Promise(function(t){t()}).then(o.bind(null,"tyP1"))},name:"编辑器"}]}],A=new E.a({scrollBehavior:function(){return{y:0}},routes:N}),k=o("zL8q"),D=o.n(k),G=(o("q8zI"),o("gxP2"),o("uMhA"),o("yh13"),o("mtWM")),q=o.n(G);n.a.prototype.$ajax=q.a,n.a.config.productionTip=!1,n.a.use(D.a),n.a.use(s),new n.a({router:A,store:g,render:function(t){return t(r)}}).$mount("#app")},ODC6:function(t,e){},epUy:function(t,e){},gxP2:function(t,e){},n3AO:function(t,e){},q8zI:function(t,e){},qW1i:function(t,e){},ryf9:function(t,e){},t30e:function(t,e){},tyP1:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=o("7t+N"),i=o.n(s),n="",a="",r="",l=!1,c=0,p=0,u="",h="",d="",m="",v=0,f=0,H=[],g=[],E=[],w=void 0,S=[],T=void 0,y={name:"equirectangular",computed:{imgUrl:function(){return this.$store.state.test.imgFile.fileUrl},isSubmit:function(){var t=this.$store.state.test.isSubmit;return t},drawedHotspots:function(){for(var t=this.$store.state.test.sum,e=0;e<t.length;e++){var o=t[e].imgFile.fileUrl;if(console.log(o),console.log(this.imgUrl),o[0]==this.imgUrl[0])return t[e].jumpHotSpots}return[]},drawedImgHotSpots:function(){for(var t=this.$store.state.test.sum,e=0;e<t.length;e++){if(t[e].imgFile.fileUrl[0]==this.imgUrl[0])return t[e].urlHotSpots.concat(t[e].imageHotSpots)}return[]},newIsDeleteHotSpot:function(){var t=this.$store.state.test.newIsDeleteHotSpot;return t},activeJumpHotSpot:function(){return this.$store.state.test.activeJumpHotSpot},inactiveJumpHotSpot:function(){return this.$store.state.test.inactiveJumpHotSpot},activeImageHotSpot:function(){return this.$store.state.test.activeImageHotSpot},inactiveImageHotSpot:function(){return this.$store.state.test.inactiveImageHotSpot},activeUrlHotSpot:function(){return this.$store.state.test.activeUrlHotSpot},inactiveUrlHotSpot:function(){return this.$store.state.test.inactiveUrlHotSpot},sceneDelete:function(){return this.$store.state.test.sceneDelete},transformX:function(){return this.$store.state.test.isVideoTransformX},transformY:function(){return this.$store.state.test.isVideoTransformY},rotate:function(){return this.$store.state.test.isVideoRotate},scale:function(){return this.$store.state.test.isVideoScale}},watch:{imgUrl:function(t){document.getElementById("container").innerHTML="",this.$store.commit("clearHotSpots"),this.init(t),this.animate()},isSubmit:function(){for(var t=n.children,e=[],o=[],s=(this.$store.state.test.hotUrl,0),i=t.length;s<i;s++){if("sprite"===t[s].type.toLowerCase()){var a=this.calculatePanandTilt(1.25*t[s].position.x,1.25*t[s].position.y,1.25*t[s].position.z);o.push({panAndTilt:a,position:[1.25*t[s].position.x,1.25*t[s].position.y,1.25*t[s].position.z]})}if("meshnormalmaterial"===t[s].material.type.toLowerCase()){for(var r=[],l=0,c=t[s].geometry.vertices.length;l<c;l++)r.push(this.calculatePanandTilt(t[s].geometry.vertices[l].x,t[s].geometry.vertices[l].y,t[s].geometry.vertices[l].z));e.push({panAndTilt:r,position:t[s].geometry.vertices})}}this.$store.dispatch("hotSpots",{sprites:o}),this.$store.dispatch("imgHotSpots",{imgHotSpots:e})},newIsDeleteHotSpot:function(){this.$store.state.test.newIsDeleteHotSpot&&(4===this.$store.state.test.pid&&this.deleteJumpHotSpot(this.$store.state.test),6!==this.$store.state.test.pid&&7!==this.$store.state.test.pid||this.deleteImageHotSpot(this.$store.state.test))},activeJumpHotSpot:function(){for(var t=0;t<this.$store.state.test.jumpHotSpots.length;t++)this.$store.state.test.jumpHotSpots[t].hasOwnProperty("active")&&(this.deleteJumpHotSpot(this.$store.state.test.jumpHotSpots[t]),this.drawJumpHotSpot(this.$store.state.test.jumpHotSpots[t].position,"static/textures/hotspot.svg"),delete this.$store.state.test.jumpHotSpots[t].active);for(var e=0;e<this.$store.state.test.jumpHotSpots.length;e++)Math.round(this.$store.state.test.jumpHotSpots[e].position[0])===Math.round(this.$store.state.test.activePost.children[0].position[0])&&Math.round(this.$store.state.test.jumpHotSpots[e].position[1])===Math.round(this.$store.state.test.activePost.children[0].position[1])&&Math.round(this.$store.state.test.jumpHotSpots[e].position[2])===Math.round(this.$store.state.test.activePost.children[0].position[2])&&(this.$store.state.test.jumpHotSpots[e].active=!0,this.deleteJumpHotSpot(this.$store.state.test.jumpHotSpots[e]),this.drawJumpHotSpot(this.$store.state.test.activePost.children[0].position,"static/textures/Clickhotspot.svg"))},inactiveJumpHotSpot:function(){for(var t=0;t<this.$store.state.test.jumpHotSpots.length;t++)this.$store.state.test.jumpHotSpots[t].hasOwnProperty("active")&&(this.deleteJumpHotSpot(this.$store.state.test.jumpHotSpots[t]),this.drawJumpHotSpot(this.$store.state.test.jumpHotSpots[t].position,"static/textures/hotspot.svg"),delete this.$store.state.test.jumpHotSpots[t].active)},activeImageHotSpot:function(){for(var t=0;t<this.$store.state.test.imageHotSpots.length;t++)this.$store.state.test.imageHotSpots[t].hasOwnProperty("active")&&(this.deleteImageHotSpot(this.$store.state.test.imageHotSpots[t]),this.drawImageHotSpot(this.$store.state.test.imageHotSpots[t].position),delete this.$store.state.test.imageHotSpots[t].active);for(var e=0;e<this.$store.state.test.imageHotSpots.length;e++)Math.round(this.$store.state.test.imageHotSpots[e].position[0].x)===Math.round(this.$store.state.test.activePost.children[0].position[0].x)&&Math.round(this.$store.state.test.imageHotSpots[e].position[1].x)===Math.round(this.$store.state.test.activePost.children[0].position[1].x)&&Math.round(this.$store.state.test.imageHotSpots[e].position[2].x)===Math.round(this.$store.state.test.activePost.children[0].position[2].x)&&Math.round(this.$store.state.test.imageHotSpots[e].position[3].x)===Math.round(this.$store.state.test.activePost.children[0].position[3].x)&&(this.$store.state.test.imageHotSpots[e].active=!0,this.deleteImageHotSpot(this.$store.state.test.imageHotSpots[e]),this.drawNewImageHotSpot(this.$store.state.test.imageHotSpots[e].position))},inactiveImageHotSpot:function(){for(var t=0;t<this.$store.state.test.imageHotSpots.length;t++)this.$store.state.test.imageHotSpots[t].hasOwnProperty("active")&&(this.deleteImageHotSpot(this.$store.state.test.imageHotSpots[t]),this.drawImageHotSpot(this.$store.state.test.imageHotSpots[t].position),delete this.$store.state.test.imageHotSpots[t].active)},activeUrlHotSpot:function(){for(var t=0;t<this.$store.state.test.urlHotSpots.length;t++)this.$store.state.test.urlHotSpots[t].hasOwnProperty("active")&&(this.deleteImageHotSpot(this.$store.state.test.urlHotSpots[t]),this.drawImageHotSpot(this.$store.state.test.urlHotSpots[t].position),delete this.$store.state.test.urlHotSpots[t].active);for(var e=0;e<this.$store.state.test.urlHotSpots.length;e++)Math.round(this.$store.state.test.urlHotSpots[e].position[0].x)===Math.round(this.$store.state.test.activePost.children[0].position[0].x)&&Math.round(this.$store.state.test.urlHotSpots[e].position[1].x)===Math.round(this.$store.state.test.activePost.children[0].position[1].x)&&Math.round(this.$store.state.test.urlHotSpots[e].position[2].x)===Math.round(this.$store.state.test.activePost.children[0].position[2].x)&&(this.$store.state.test.urlHotSpots[e].active=!0,this.deleteImageHotSpot(this.$store.state.test.urlHotSpots[e]),this.drawNewImageHotSpot(this.$store.state.test.urlHotSpots[e].position))},inactiveUrlHotSpot:function(){for(var t=0;t<this.$store.state.test.urlHotSpots.length;t++)this.$store.state.test.urlHotSpots[t].hasOwnProperty("active")&&(this.deleteImageHotSpot(this.$store.state.test.urlHotSpots[t]),this.drawImageHotSpot(this.$store.state.test.urlHotSpots[t].position),delete this.$store.state.test.urlHotSpots[t].active)},sceneDelete:function(){this.$store.commit("saveimgFile",{fileUrl:[],fileName:""})},transformX:function(){for(var t=0;t<n.children.length;t++)n.children[t].uuid===T&&n.children.splice(t,1);this.newDrawVideoHotSpotX(this.$store.state.test.oldselected,this.$store.state.test.valueX)},transformY:function(){for(var t=0;t<n.children.length;t++)n.children[t].uuid===T&&n.children.splice(t,1);this.newDrawVideoHotSpotY(this.$store.state.test.oldselected,this.$store.state.test.valueY)},rotate:function(){for(var t=0;t<n.children.length;t++)n.children[t].uuid===T&&n.children.splice(t,1);this.newDrawVideoHotSpotR(this.$store.state.test.oldselected,this.$store.state.test.valueR)},scale:function(){for(var t=0;t<n.children.length;t++)n.children[t].uuid===T&&n.children.splice(t,1);this.drawScaleVideoHotSpot(this.$store.state.test.oldselected,this.$store.state.test.videoScale)}},mounted:function(){this.readXMl(),this.init(this.imgUrl),this.animate()},methods:{readXMl:function(){i.a.ajax({url:"static/Test.xml",dataType:"xml",type:"GET",timeout:2e3,async:!1,error:function(t){alert("加载XML文件出错！")},success:function(t){for(var e=i()(t).find("panorama"),o=i()(t).find("panorama").length,s=0;s<o;s++){var n={panorama:[],input:[],polystyle:[],hotspot:[],polyhotspot:{urlHotSpots:[],imageHotSpots:[]},fileArr:[]},a={fileName:[],fileUrl:[]};n.panorama=e.eq(s).attr("id"),a.fileName=e.eq(s).find("input").attr("fileName"),a.fileUrl=e.eq(s).find("input").attr("fileUrl"),n.fileArr.push(a),n.input=e.eq(s).find("input").attr("leveltileurl"),n.polystyle=e.eq(s).find("polystyle").attr("mode");for(var r=e.eq(s).find("hotspot").length,l=e.eq(s).find("hotspot"),c=e.eq(s).find("polyhotspot"),p=c.length,u=0;u<r;u++){var h={tilt:[],url:[],id:[],position:[],panAndTilt:[]};h.panAndTilt[0]=l.eq(u).attr("pan"),h.panAndTilt[1]=l.eq(u).attr("tilt"),h.url=l.eq(u).attr("url"),h.title=l.eq(u).attr("title"),h.id=l.eq(u).attr("id"),h.position[0]=l.eq(u).attr("jumpHotSpotsx"),h.position[1]=l.eq(u).attr("jumpHotSpotsy"),h.position[2]=l.eq(u).attr("jumpHotSpotsz"),n.hotspot.push(h)}for(var d=0;d<p;d++)if("hpimage"===c.eq(d).attr("id")){var m={position:[],target:[],panAndTilt:[]};m.target=c.eq(d).attr("target");for(var v=c.eq(d).find("vertex"),f=0;f<v.length;f++)m.panAndTilt[f]=new Array(2),m.position[f]={x:[],y:[],z:[]},m.panAndTilt[f][0]=v.eq(f).attr("pan"),m.panAndTilt[f][1]=v.eq(f).attr("tilt"),m.position[f].x=v.eq(f).attr("imageHotSpotsx"),m.position[f].y=v.eq(f).attr("imageHotSpotsy"),m.position[f].z=v.eq(f).attr("imageHotSpotsz");n.polyhotspot.imageHotSpots.push(m)}else{var H={position:[],id:[],url:[],panAndTilt:[]};H.id=c.eq(d).attr("id"),H.url=c.eq(d).attr("url");for(var g=c.eq(d).find("vertex"),E=0;E<g.length;E++)H.panAndTilt[E]=new Array(2),H.position[E]={x:[],y:[],z:[]},H.panAndTilt[E][0]=g.eq(E).attr("pan"),H.panAndTilt[E][1]=g.eq(E).attr("tilt"),H.position[E].x=g.eq(E).attr("urlHotSpotsx"),H.position[E].y=g.eq(E).attr("urlHotSpotsy"),H.position[E].z=g.eq(E).attr("urlHotSpotsz");n.polyhotspot.urlHotSpots.push(H)}S.push(n)}}});for(var t=this.$store.state.test,e=0;e<S.length;e++)t.fileUrlArr.push(S[e].fileArr[0])},init:function(t){if(t.length>1)alert("抱歉，一张图请选择panorama1，六张图请选择panorama6且只支持cubeFaces");else{var e="";e=document.getElementById("container"),n=new THREE.Scene,(a=new THREE.PerspectiveCamera(75,(window.innerWidth-340)/(window.innerHeight-90),1,1100)).target=new THREE.Vector3(0,0,0);var o=new THREE.SphereGeometry(500,60,40);o.scale(-1,1,1);var s=document.createElement("canvas");s.style.backgroundColor="rgba(255,255,255,0)";var i=s.getContext("2d"),l=new Image;l.src=t[0],l.onload=function(){s.width=this.width,s.height=this.height,i.drawImage(l,0,0,this.width,this.height);var t=new THREE.Texture;t.image=s,t.needsUpdate=!0,t.minFilter=THREE.LinearFilter;var e=new THREE.MeshBasicMaterial({map:t,transparent:!1});w=new THREE.Mesh(o,e),n.add(w)},this.drawJumpHotSpots(this.drawedHotspots,"static/textures/hotspot.svg"),this.drawImageHotSpots(this.drawedImgHotSpots);for(var c=-1,p=this.$store.state.test,u=0;u<S.length;u++)S[u].fileArr[0].fileUrl===p.imgFile.fileUrl[0]&&(c=u);if(-1!==c){for(var h=S[c].hotspot.length,d=0;d<h;d++){var m={};m.hotTarget=S[c].hotspot[d].url.replace("{","").replace("}","").replace("node","场景"),m.hotIntroduction=S[c].hotspot[d].title.replace("{","").replace("}",""),m.position=S[c].hotspot[d].position,m.panAndTilt=S[c].hotspot[d].panAndTilt,p.jumpHotSpots.push(m)}for(var v=S[c].polyhotspot.imageHotSpots.length,f=S[c].polyhotspot.urlHotSpots.length,H=0;H<f;H++){var g={};g.hotUrl=S[c].polyhotspot.urlHotSpots[H].url.match(/([^/]+)$/)[1],g.position=S[c].polyhotspot.urlHotSpots[H].position,g.panAndTilt=S[c].polyhotspot.urlHotSpots[H].panAndTilt,p.urlHotSpots.push(g)}for(var E=0;E<v;E++){var T={};T.hotImage=S[c].polyhotspot.imageHotSpots[E].target.match(/([^/]+)$/)[1],T.position=S[c].polyhotspot.imageHotSpots[E].position,T.panAndTilt=S[c].polyhotspot.imageHotSpots[E].panAndTilt,p.imageHotSpots.push(T)}this.drawJumpHotSpots(S[c].hotspot,"static/textures/hotspot.svg"),this.drawImageHotSpots(S[c].polyhotspot.imageHotSpots),this.drawImageHotSpots(S[c].polyhotspot.urlHotSpots)}this.$store.commit("addArr",S),(r=new THREE.WebGLRenderer).setPixelRatio(window.devicePixelRatio),r.setSize(window.innerWidth-340,window.innerHeight-90),e.appendChild(r.domElement),document.getElementsByTagName("canvas")[0].addEventListener("mousedown",this.onDocumentMouseDown,!1),document.getElementsByTagName("canvas")[0].addEventListener("mousemove",this.onDocumentMouseMove,!1),document.getElementsByTagName("canvas")[0].addEventListener("mouseup",this.onDocumentMouseUp,!1),document.getElementsByTagName("canvas")[0].addEventListener("wheel",this.onDocumentMouseWheel,!1),document.getElementsByTagName("canvas")[0].addEventListener("dragover",function(t){t.preventDefault(),t.dataTransfer.dropEffect="copy"},!1),document.getElementsByTagName("canvas")[0].addEventListener("dragenter",function(){document.body.style.opacity=.5},!1),document.getElementsByTagName("canvas")[0].addEventListener("dragleave",function(){document.body.style.opacity=1},!1),window.addEventListener("resize",this.onWindowResize,!1)}},onWindowResize:function(){a.aspect=(window.innerWidth-340)/(window.innerHeight-90),a.updateProjectionMatrix(),r.setSize(window.innerWidth-340,window.innerHeight-90)},onDocumentMouseDown:function(t){if("Auto"===this.$store.state.test.imgType||"Equirectangular"===this.$store.state.test.imgType){t.preventDefault();var e=new THREE.Vector3;e.set((t.clientX-320)/(window.innerWidth-340)*2-1,-(t.clientY-70)/(window.innerHeight-90)*2+1,.5),e.unproject(a);var o=new THREE.Raycaster(a.position,e.sub(a.position).normalize()).intersectObjects(n.children);if(this.$store.state.test.isHotspot){if(o.length>0){var s=o[0];s.point,H.push(s.point.x),g.push(s.point.y),E.push(s.point.z)}if(3==H.length){document.getElementById("container").style.cursor="default",this.$store.dispatch("isHotspot");var i=(H[0]+H[1]+H[2])/3,r=(g[0]+g[1]+g[2])/3,v=(E[0]+E[1]+E[2])/3,f=document.createElement("canvas");f.style.backgroundColor="rgba(255,255,255,0)";var w=f.getContext("2d");f.width=128,f.height=128;var S=new Image;S.src="static/textures/hotspot.svg",S.onload=function(){w.drawImage(S,0,0);var t=new THREE.Texture(f);t.needsUpdate=!0,t.minFilter=THREE.LinearFilter;var e=new THREE.SpriteMaterial({map:t,transparent:!1}),o=new THREE.Sprite(e);o.scale.set(30,30,30);var s=new THREE.Vector3(.8*i,.8*r,.8*v);o.position.copy(s),n.add(o)},H=[],g=[],E=[]}}else if(o.length>0){var T=o[0];try{if(T.object&&T.object.type.length>0&&"sprite"==T.object.type.toLowerCase())if(this.$store.state.test.isDeleteHotSpot)n.remove(T.object),this.$store.commit("deletedHotSpot"),this.$store.commit("hideHotSpot");else{var y=T.object.position,R=this.calculatePanandTilt(1.25*y.x,1.25*y.y,1.25*y.z);this.$store.commit("showJumpHotSpot"),this.$store.commit("saveTempLocation",{location:[1.25*y.x,1.25*y.y,1.25*y.z],panAndTilt:R,ID:"JumpHotSpot"})}}catch(t){console.log(t)}}if(this.$store.state.test.isImageHotspot){if(o.length>0){s=o[0];s.point,H.push(s.point.x),g.push(s.point.y),E.push(s.point.z)}if(1==H.length){var $=new THREE.Geometry,x=new THREE.PointsMaterial({color:255,size:10});$.vertices.push(new THREE.Vector3(H[0],g[0],E[0]));var M=new THREE.Points($,x);n.add(M)}if(2==H.length){var b=new THREE.Geometry,I=new THREE.ParticleBasicMaterial({color:255,size:10});b.vertices.push(new THREE.Vector3(H[1],g[1],E[1]));var _=new THREE.Points(b,I);n.add(_);var F=new THREE.Geometry;F.vertices.push(new THREE.Vector3(H[0],g[0],E[0])),F.vertices.push(new THREE.Vector3(H[1],g[1],E[1]));var z=new THREE.Line(F,I,THREE.LineSegments);n.add(z)}if(3==H.length){var U=new THREE.Geometry,L=new THREE.ParticleBasicMaterial({color:255,size:10});U.vertices.push(new THREE.Vector3(H[2],g[2],E[2]));var V=new THREE.Points(U,L);n.add(V);var C=new THREE.Geometry;C.vertices.push(new THREE.Vector3(H[1],g[1],E[1])),C.vertices.push(new THREE.Vector3(H[2],g[2],E[2]));var j=new THREE.Line(C,L,THREE.LineSegments);n.add(j);var P=new THREE.Geometry;P.vertices.push(new THREE.Vector3(H[2],g[2],E[2])),P.vertices.push(new THREE.Vector3(H[0],g[0],E[0]));var N=new THREE.Line(P,L,THREE.LineSegments);n.add(N)}if(4===H.length){var A=function(t,e,o){var s=t.clone();return s.cross(e),s.normalize(),(s.x*o.x+s.y*o.y+s.z*o.z)/Math.sqrt(o.x*o.x+o.y*o.y+o.z*o.z)};document.getElementById("container").style.cursor="default",this.$store.dispatch("isImageHotspot");for(var k=n.children,D=0;D<k.length;D++)"points"!==k[D].type.toLowerCase()&&"line"!==k[D].type.toLowerCase()||(n.remove(k[D]),D--);var G=new THREE.Vector3(H[0],g[0],E[0]),q=new THREE.Vector3(H[1],g[1],E[1]),J=new THREE.Vector3(H[2],g[2],E[2]),O=new THREE.Vector3(H[3],g[3],E[3]),W=new THREE.Geometry;W.vertices.push(G),W.vertices.push(q),W.vertices.push(J),W.vertices.push(O);var X=[H[0],g[0],E[0]],B=[H[1],g[1],E[1]],Y=[H[2],g[2],E[2]],K=[H[3],g[3],E[3]],Q=(B[0]-X[0])*(B[0]-X[0])+(B[1]-X[1])*(B[1]-X[1])+(B[2]-X[2])*(B[2]-X[2]),Z=(Y[0]-X[0])*(Y[0]-X[0])+(Y[1]-X[1])*(Y[1]-X[1])+(Y[2]-X[2])*(Y[2]-X[2]),tt=(K[0]-X[0])*(K[0]-X[0])+(K[1]-X[1])*(K[1]-X[1])+(K[2]-X[2])*(K[2]-X[2]),et=Math.max(Q,Z,tt),ot=W.computeFaceNormals(),st=this.calculatePanandTilt((X[0]+B[0]+Y[0]+K[0])/4,(X[1]+B[1]+Y[1]+K[1])/4,(X[2]+B[2]+Y[2]+K[2])/4);if(console.log(st),et===Q)A(G,q,J)>0?(W.faces.push(new THREE.Face3(0,2,1,ot)),W.faces.push(new THREE.Face3(1,3,0,ot))):(W.faces.push(new THREE.Face3(1,2,0,ot)),W.faces.push(new THREE.Face3(0,3,1,ot)));if(et===Z)A(G,J,q)>0?(W.faces.push(new THREE.Face3(0,1,2,ot)),W.faces.push(new THREE.Face3(2,3,0,ot))):(W.faces.push(new THREE.Face3(0,3,2,ot)),W.faces.push(new THREE.Face3(2,1,0,ot)));if(et===tt)A(G,O,q)>0?(W.faces.push(new THREE.Face3(0,1,3,ot)),W.faces.push(new THREE.Face3(3,2,0,ot))):(W.faces.push(new THREE.Face3(0,2,3,ot)),W.faces.push(new THREE.Face3(3,1,0,ot)));var it=new THREE.MeshNormalMaterial({flatShading:!0});it.transparent=!0,it.opacity=.8;var nt=new THREE.Mesh(W,it);n.add(nt),H=[],g=[],E=[]}}else if(o.length>0){var at=o[0];try{if(at.object&&at.object.type.length>0&&"meshnormalmaterial"===at.object.material.type.toLowerCase())if(this.$store.state.test.isDeleteHotSpot)console.log(at.object),n.remove(at.object),this.$store.commit("deletedHotSpot"),this.$store.commit("hideHotSpot");else{for(var rt=at.object.geometry.vertices,lt=[],ct=0,pt=rt.length;ct<pt;ct++)lt.push(this.calculatePanandTilt(rt[ct].x,rt[ct].y,rt[ct].z));this.$store.commit("showImgHotSpot"),this.$store.commit("saveTempLocation",{location:rt,panAndTilt:lt,ID:"ImgHotSpot"})}}catch(t){console.log(t)}}if(this.$store.state.test.isVideoHotspot){if(o.length>0){var ut=o[0];this.$store.dispatch("isVideoHotspot");var ht={client:[t.clientX,t.clientY],select:[ut.point.x,ut.point.y,ut.point.z],vector:{}},dt=new THREE.Vector3;dt.set((ht.client[0]-320)/(window.innerWidth-340)*2-1,-(ht.client[1]-70)/(window.innerHeight-90)*2+1,.5),dt.unproject(a),ht.vector=dt.clone(),console.log(ht),console.log(ht.vector),this.drawVideoHotSpot(ht),o={},this.$store.commit("saveOldSelected",ht)}}else if(o.length>0){var mt=o[0];try{if(mt.object&&mt.object.type.length>0&&"meshlambertmaterial"===mt.object.material.type.toLowerCase())if(this.$store.state.test.isDeleteHotSpot)console.log(mt.object),n.remove(mt.object),this.$store.commit("deletedHotSpot"),this.$store.commit("hideHotSpot");else{for(var vt=mt.object.geometry.vertices,ft=[],Ht=0,gt=vt.length;Ht<gt;Ht++)ft.push(this.calculatePanandTilt(vt[Ht].x,vt[Ht].y,vt[Ht].z));this.$store.commit("showVideoHotSpot"),this.$store.commit("saveTempLocation",{location:vt,panAndTilt:ft,ID:"VideoHotSpot"})}}catch(t){console.log(t)}}}l=!0,u=t.clientX,d=t.clientY,h=c,m=p},onDocumentMouseMove:function(t){!0===l&&(c=.1*(u-t.clientX)+h,p=.1*(t.clientY-d)+m)},onDocumentMouseUp:function(){l=!1},onDocumentMouseWheel:function(t){var e=a.fov+.05*t.deltaY;a.fov=THREE.Math.clamp(e,10,75),a.updateProjectionMatrix();var o=a.fov;console.log("star"+o),console.log(window.innerWidth+","+window.innerHeight)},animate:function(){this.imgUrl.length>1||(this.update(),requestAnimationFrame(this.animate))},update:function(){!1===l&&(c+=0),p=Math.max(-85,Math.min(85,p)),v=THREE.Math.degToRad(90-p),f=THREE.Math.degToRad(c),a.target.x=500*Math.sin(v)*Math.cos(f),a.target.y=500*Math.cos(v),a.target.z=500*Math.sin(v)*Math.sin(f),a.lookAt(a.target),r.render(n,a)},calculatePanandTilt:function(t,e,o){var s=0;return-t>0&&o<=0&&(s=180*Math.atan(o/-t)/Math.PI),-t<0&&o<0&&(s=180*Math.atan(o/-t)/Math.PI-180),-t>0&&o>=0&&(s=180*Math.atan(o/-t)/Math.PI),-t<0&&o>0&&(s=180+180*Math.atan(o/-t)/Math.PI),[s,180*Math.asin(e/500)/Math.PI]},drawJumpHotSpots:function(t,e){for(var o=function(o,s){var i=t[o].position,a=document.createElement("canvas");a.style.backgroundColor="rgba(255,255,255,0)";var r=a.getContext("2d");a.width=128,a.height=128;var l=new Image;l.src=e,l.onload=function(){r.drawImage(l,0,0);var t=new THREE.Texture(a);t.needsUpdate=!0,t.minFilter=THREE.LinearFilter;var e=new THREE.SpriteMaterial({map:t,transparent:!1}),o=new THREE.Sprite(e);o.scale.set(30,30,30);var s=new THREE.Vector3(.8*i[0],.8*i[1],.8*i[2]);o.position.copy(s),n.add(o)}},s=0,i=t.length;s<i;s++)o(s)},drawJumpHotSpot:function(t,e){var o=t,s=document.createElement("canvas");s.style.backgroundColor="rgba(255,255,255,0)";var i=s.getContext("2d");s.width=128,s.height=128;var a=new Image;a.src=e,a.onload=function(){i.drawImage(a,0,0);var t=new THREE.Texture(s);t.needsUpdate=!0,t.minFilter=THREE.LinearFilter;var e=new THREE.SpriteMaterial({map:t,transparent:!1}),r=new THREE.Sprite(e);r.scale.set(30,30,30);var l=new THREE.Vector3(.8*o[0],.8*o[1],.8*o[2]);r.position.copy(l),n.add(r)}},drawImageHotSpots:function(t){for(var e=0,o=t.length;e<o;e++){var s=function(t,e,o){var s=t.clone();return s.cross(e),s.normalize(),(s.x*o.x+s.y*o.y+s.z*o.z)/Math.sqrt(o.x*o.x+o.y*o.y+o.z*o.z)},i=t[e].position,a=new THREE.Vector3(i[0].x,i[0].y,i[0].z),r=new THREE.Vector3(i[1].x,i[1].y,i[1].z),l=new THREE.Vector3(i[2].x,i[2].y,i[2].z),c=new THREE.Vector3(i[3].x,i[3].y,i[3].z),p=new THREE.Geometry;p.vertices.push(a),p.vertices.push(r),p.vertices.push(l),p.vertices.push(c);var u=[i[0].x,i[0].y,i[0].z],h=[i[1].x,i[1].y,i[1].z],d=[i[2].x,i[2].y,i[2].z],m=[i[3].x,i[3].y,i[3].z],v=(h[0]-u[0])*(h[0]-u[0])+(h[1]-u[1])*(h[1]-u[1])+(h[2]-u[2])*(h[2]-u[2]),f=(d[0]-u[0])*(d[0]-u[0])+(d[1]-u[1])*(d[1]-u[1])+(d[2]-u[2])*(d[2]-u[2]),H=(m[0]-u[0])*(m[0]-u[0])+(m[1]-u[1])*(m[1]-u[1])+(m[2]-u[2])*(m[2]-u[2]),g=Math.max(v,f,H),E=p.computeFaceNormals();if(g===v)s(a,r,l)>0?(p.faces.push(new THREE.Face3(0,2,1,E)),p.faces.push(new THREE.Face3(1,3,0,E))):(p.faces.push(new THREE.Face3(1,2,0,E)),p.faces.push(new THREE.Face3(0,3,1,E)));if(g===f)s(a,l,r)>0?(p.faces.push(new THREE.Face3(0,1,2,E)),p.faces.push(new THREE.Face3(2,3,0,E))):(p.faces.push(new THREE.Face3(0,3,2,E)),p.faces.push(new THREE.Face3(2,1,0,E)));if(g===H)s(a,c,r)>0?(p.faces.push(new THREE.Face3(0,1,3,E)),p.faces.push(new THREE.Face3(3,2,0,E))):(p.faces.push(new THREE.Face3(0,2,3,E)),p.faces.push(new THREE.Face3(3,1,0,E)));p.computeFaceNormals();var w=new THREE.MeshNormalMaterial({flatShading:!0});w.transparent=!0,w.opacity=.4;var S=new THREE.Mesh(p,w);n.add(S)}},drawImageHotSpot:function(t){var e=t,o=new THREE.Vector3(e[0].x,e[0].y,e[0].z),s=new THREE.Vector3(e[1].x,e[1].y,e[1].z),i=new THREE.Vector3(e[2].x,e[2].y,e[2].z),a=new THREE.Vector3(e[3].x,e[3].y,e[3].z),r=new THREE.Geometry;r.vertices.push(o),r.vertices.push(s),r.vertices.push(i),r.vertices.push(a);var l=[e[0].x,e[0].y,e[0].z],c=[e[1].x,e[1].y,e[1].z],p=[e[2].x,e[2].y,e[2].z],u=[e[3].x,e[3].y,e[3].z],h=(c[0]-l[0])*(c[0]-l[0])+(c[1]-l[1])*(c[1]-l[1])+(c[2]-l[2])*(c[2]-l[2]),d=(p[0]-l[0])*(p[0]-l[0])+(p[1]-l[1])*(p[1]-l[1])+(p[2]-l[2])*(p[2]-l[2]),m=(u[0]-l[0])*(u[0]-l[0])+(u[1]-l[1])*(u[1]-l[1])+(u[2]-l[2])*(u[2]-l[2]),v=Math.max(h,d,m),f=r.computeFaceNormals();function H(t,e,o){var s=t.clone();return s.cross(e),s.normalize(),(s.x*o.x+s.y*o.y+s.z*o.z)/Math.sqrt(o.x*o.x+o.y*o.y+o.z*o.z)}v===h&&(H(o,s,i)>0?(r.faces.push(new THREE.Face3(0,2,1,f)),r.faces.push(new THREE.Face3(1,3,0,f))):(r.faces.push(new THREE.Face3(1,2,0,f)),r.faces.push(new THREE.Face3(0,3,1,f))));v===d&&(H(o,i,s)>0?(r.faces.push(new THREE.Face3(0,1,2,f)),r.faces.push(new THREE.Face3(2,3,0,f))):(r.faces.push(new THREE.Face3(0,3,2,f)),r.faces.push(new THREE.Face3(2,1,0,f))));v===m&&(H(o,a,s)>0?(r.faces.push(new THREE.Face3(0,1,3,f)),r.faces.push(new THREE.Face3(3,2,0,f))):(r.faces.push(new THREE.Face3(0,2,3,f)),r.faces.push(new THREE.Face3(3,1,0,f))));r.computeFaceNormals();var g=new THREE.MeshNormalMaterial({flatShading:!0});g.transparent=!0,g.opacity=.4;var E=new THREE.Mesh(r,g);n.add(E)},drawNewImageHotSpot:function(t){var e=t,o=new THREE.Vector3(e[0].x,e[0].y,e[0].z),s=new THREE.Vector3(e[1].x,e[1].y,e[1].z),i=new THREE.Vector3(e[2].x,e[2].y,e[2].z),a=new THREE.Vector3(e[3].x,e[3].y,e[3].z),r=new THREE.Geometry;r.vertices.push(o),r.vertices.push(s),r.vertices.push(i),r.vertices.push(a);var l=[e[0].x,e[0].y,e[0].z],c=[e[1].x,e[1].y,e[1].z],p=[e[2].x,e[2].y,e[2].z],u=[e[3].x,e[3].y,e[3].z],h=(c[0]-l[0])*(c[0]-l[0])+(c[1]-l[1])*(c[1]-l[1])+(c[2]-l[2])*(c[2]-l[2]),d=(p[0]-l[0])*(p[0]-l[0])+(p[1]-l[1])*(p[1]-l[1])+(p[2]-l[2])*(p[2]-l[2]),m=(u[0]-l[0])*(u[0]-l[0])+(u[1]-l[1])*(u[1]-l[1])+(u[2]-l[2])*(u[2]-l[2]),v=Math.max(h,d,m),f=r.computeFaceNormals();function H(t,e,o){var s=t.clone();return s.cross(e),s.normalize(),(s.x*o.x+s.y*o.y+s.z*o.z)/Math.sqrt(o.x*o.x+o.y*o.y+o.z*o.z)}v===h&&(H(o,s,i)>0?(r.faces.push(new THREE.Face3(0,2,1,f)),r.faces.push(new THREE.Face3(1,3,0,f))):(r.faces.push(new THREE.Face3(1,2,0,f)),r.faces.push(new THREE.Face3(0,3,1,f))));v===d&&(H(o,i,s)>0?(r.faces.push(new THREE.Face3(0,1,2,f)),r.faces.push(new THREE.Face3(2,3,0,f))):(r.faces.push(new THREE.Face3(0,3,2,f)),r.faces.push(new THREE.Face3(2,1,0,f))));v===m&&(H(o,a,s)>0?(r.faces.push(new THREE.Face3(0,1,3,f)),r.faces.push(new THREE.Face3(3,2,0,f))):(r.faces.push(new THREE.Face3(0,2,3,f)),r.faces.push(new THREE.Face3(3,1,0,f))));r.computeFaceNormals();var g=new THREE.MeshLambertMaterial({color:255});g.transparent=!0,g.opacity=.4;var E=new THREE.Mesh(r,g);n.add(E)},deleteJumpHotSpot:function(t){for(var e=0;e<n.children.length;e++)"sprite"===n.children[e].type.toLowerCase()&&Math.round(1.25*n.children[e].position.x)===Math.round(t.position[0])&&Math.round(1.25*n.children[e].position.y)===Math.round(t.position[1])&&Math.round(1.25*n.children[e].position.z)===Math.round(t.position[2])&&(n.children.splice(e,1),this.$store.commit("deletedHotSpot"),this.$store.commit("hideHotSpot"))},deleteImageHotSpot:function(t){for(var e=0;e<n.children.length;e++)"mesh"===n.children[e].type.toLowerCase()&&Math.round(n.children[e].geometry.vertices[0].x)===Math.round(t.position[0].x)&&Math.round(n.children[e].geometry.vertices[1].x)===Math.round(t.position[1].x)&&Math.round(n.children[e].geometry.vertices[2].x)===Math.round(t.position[2].x)&&Math.round(n.children[e].geometry.vertices[3].x)===Math.round(t.position[3].x)&&(n.children.splice(e,1),this.$store.commit("deletedHotSpot"),this.$store.commit("hideHotSpot"))},drawVideoHotSpot:function(t){var e={},o=this;function s(e,s){var i=new THREE.Vector3;i.set((t.client[0]-320+e)/(window.innerWidth-340)*2-1,-(t.client[1]-70+s)/(window.innerHeight-90)*2+1,.5),i.unproject(a),o.$store.commit("saveVideoGroup",i);var r=new THREE.Raycaster(a.position,i.sub(a.position).normalize());return r.set(a.position,i.sub(a.position).normalize()),r.intersectObjects(n.children)[0]}e=s(160,120),H.push(e.point.x),g.push(e.point.y),E.push(e.point.z),e=s(-160,-120),H.push(e.point.x),g.push(e.point.y),E.push(e.point.z),e=s(-160,120),H.push(e.point.x),g.push(e.point.y),E.push(e.point.z),e=s(160,-120),H.push(e.point.x),g.push(e.point.y),E.push(e.point.z);var i=new THREE.Vector3(H[0],g[0],E[0]),r=new THREE.Vector3(H[1],g[1],E[1]),l=new THREE.Vector3(H[2],g[2],E[2]),c=new THREE.Vector3(H[3],g[3],E[3]),p=new THREE.Geometry;p.vertices.push(i),p.vertices.push(r),p.vertices.push(l),p.vertices.push(c);var u=[H[0],g[0],E[0]],h=[H[1],g[1],E[1]],d=[H[2],g[2],E[2]],m=[H[3],g[3],E[3]],v=(h[0]-u[0])*(h[0]-u[0])+(h[1]-u[1])*(h[1]-u[1])+(h[2]-u[2])*(h[2]-u[2]),f=(d[0]-u[0])*(d[0]-u[0])+(d[1]-u[1])*(d[1]-u[1])+(d[2]-u[2])*(d[2]-u[2]),w=(m[0]-u[0])*(m[0]-u[0])+(m[1]-u[1])*(m[1]-u[1])+(m[2]-u[2])*(m[2]-u[2]),S=Math.max(v,f,w),y=p.computeFaceNormals();function R(t,e,o){var s=t.clone();return s.cross(e),s.normalize(),(s.x*o.x+s.y*o.y+s.z*o.z)/Math.sqrt(o.x*o.x+o.y*o.y+o.z*o.z)}S===v&&(R(i,r,l)>0?(p.faces.push(new THREE.Face3(0,2,1,y)),p.faces.push(new THREE.Face3(1,3,0,y))):(p.faces.push(new THREE.Face3(1,2,0,y)),p.faces.push(new THREE.Face3(0,3,1,y))));S===f&&(R(i,l,r)>0?(p.faces.push(new THREE.Face3(0,1,2,y)),p.faces.push(new THREE.Face3(2,3,0,y))):(p.faces.push(new THREE.Face3(0,3,2,y)),p.faces.push(new THREE.Face3(2,1,0,y))));S===w&&(R(i,c,r)>0?(p.faces.push(new THREE.Face3(0,1,3,y)),p.faces.push(new THREE.Face3(3,2,0,y))):(p.faces.push(new THREE.Face3(0,2,3,y)),p.faces.push(new THREE.Face3(3,1,0,y))));var $=new THREE.MeshLambertMaterial({color:16777215});$.transparent=!0,$.opacity=.8;var x=new THREE.Mesh(p,$);console.log("old:"),console.log(x),T=x.uuid,n.add(x),H=[],g=[],E=[]},drawRotateVideoHotSpot:function(t,e){var o={},s=200*Math.cos(Math.atan(.75)+e/180*Math.PI),i=200*Math.sin(Math.atan(.75)+e/180*Math.PI),r=200*Math.cos(Math.PI-Math.atan(.75)+e/180*Math.PI),l=200*Math.sin(Math.PI-Math.atan(.75)+e/180*Math.PI),c=200*Math.cos(Math.PI+Math.atan(.75)+e/180*Math.PI),p=200*Math.sin(Math.PI+Math.atan(.75)+e/180*Math.PI),u=200*Math.cos(-Math.atan(.75)+e/180*Math.PI),h=200*Math.sin(-Math.atan(.75)+e/180*Math.PI);function d(e,o){var s=new THREE.Vector3;s.set((t.client[0]-320+e)/(window.innerWidth-340)*2-1,-(t.client[1]-70+o)/(window.innerHeight-90)*2+1,.5),s.unproject(a);var i=new THREE.Raycaster(a.position,s.sub(a.position).normalize());return i.set(a.position,s.sub(a.position).normalize()),i.intersectObjects(n.children)[0]}o=d(s,i),H.push(o.point.x),g.push(o.point.y),E.push(o.point.z),o=d(c,p),H.push(o.point.x),g.push(o.point.y),E.push(o.point.z),o=d(r,l),H.push(o.point.x),g.push(o.point.y),E.push(o.point.z),o=d(u,h),H.push(o.point.x),g.push(o.point.y),E.push(o.point.z);var m=new THREE.Vector3(H[0],g[0],E[0]),v=new THREE.Vector3(H[1],g[1],E[1]),f=new THREE.Vector3(H[2],g[2],E[2]),w=new THREE.Vector3(H[3],g[3],E[3]),S=new THREE.Geometry;S.vertices.push(m),S.vertices.push(v),S.vertices.push(f),S.vertices.push(w);var y=[H[0],g[0],E[0]],R=[H[1],g[1],E[1]],$=[H[2],g[2],E[2]],x=[H[3],g[3],E[3]],M=(R[0]-y[0])*(R[0]-y[0])+(R[1]-y[1])*(R[1]-y[1])+(R[2]-y[2])*(R[2]-y[2]),b=($[0]-y[0])*($[0]-y[0])+($[1]-y[1])*($[1]-y[1])+($[2]-y[2])*($[2]-y[2]),I=(x[0]-y[0])*(x[0]-y[0])+(x[1]-y[1])*(x[1]-y[1])+(x[2]-y[2])*(x[2]-y[2]),_=Math.max(M,b,I),F=S.computeFaceNormals();function z(t,e,o){var s=t.clone();return s.cross(e),s.normalize(),(s.x*o.x+s.y*o.y+s.z*o.z)/Math.sqrt(o.x*o.x+o.y*o.y+o.z*o.z)}_===M&&(z(m,v,f)>0?(S.faces.push(new THREE.Face3(0,2,1,F)),S.faces.push(new THREE.Face3(1,3,0,F))):(S.faces.push(new THREE.Face3(1,2,0,F)),S.faces.push(new THREE.Face3(0,3,1,F))));_===b&&(z(m,f,v)>0?(S.faces.push(new THREE.Face3(0,1,2,F)),S.faces.push(new THREE.Face3(2,3,0,F))):(S.faces.push(new THREE.Face3(0,3,2,F)),S.faces.push(new THREE.Face3(2,1,0,F))));_===I&&(z(m,w,v)>0?(S.faces.push(new THREE.Face3(0,1,3,F)),S.faces.push(new THREE.Face3(3,2,0,F))):(S.faces.push(new THREE.Face3(0,2,3,F)),S.faces.push(new THREE.Face3(3,1,0,F))));var U=new THREE.MeshLambertMaterial({color:16777215});U.transparent=!0,U.opacity=.8;var L=new THREE.Mesh(S,U);T=L.uuid,n.add(L),H=[],g=[],E=[]},drawScaleVideoHotSpot:function(t,e){var o={};function s(e,o){var s=new THREE.Vector3;s.set((t.client[0]-320+e)/(window.innerWidth-340)*2-1,-(t.client[1]-70+o)/(window.innerHeight-90)*2+1,.5),s.unproject(a);var i=new THREE.Raycaster(a.position,s.sub(a.position).normalize());return i.set(a.position,s.sub(a.position).normalize()),i.intersectObjects(n.children)[0]}o=s(160*e,120*e),H.push(o.point.x),g.push(o.point.y),E.push(o.point.z),o=s(-160*e,-120*e),H.push(o.point.x),g.push(o.point.y),E.push(o.point.z),o=s(-160*e,120*e),H.push(o.point.x),g.push(o.point.y),E.push(o.point.z),o=s(160*e,-120*e),H.push(o.point.x),g.push(o.point.y),E.push(o.point.z);var i=new THREE.Vector3(H[0],g[0],E[0]),r=new THREE.Vector3(H[1],g[1],E[1]),l=new THREE.Vector3(H[2],g[2],E[2]),c=new THREE.Vector3(H[3],g[3],E[3]),p=new THREE.Geometry;p.vertices.push(i),p.vertices.push(r),p.vertices.push(l),p.vertices.push(c);var u=[H[0],g[0],E[0]],h=[H[1],g[1],E[1]],d=[H[2],g[2],E[2]],m=[H[3],g[3],E[3]],v=(h[0]-u[0])*(h[0]-u[0])+(h[1]-u[1])*(h[1]-u[1])+(h[2]-u[2])*(h[2]-u[2]),f=(d[0]-u[0])*(d[0]-u[0])+(d[1]-u[1])*(d[1]-u[1])+(d[2]-u[2])*(d[2]-u[2]),w=(m[0]-u[0])*(m[0]-u[0])+(m[1]-u[1])*(m[1]-u[1])+(m[2]-u[2])*(m[2]-u[2]),S=Math.max(v,f,w),y=p.computeFaceNormals();function R(t,e,o){var s=t.clone();return s.cross(e),s.normalize(),(s.x*o.x+s.y*o.y+s.z*o.z)/Math.sqrt(o.x*o.x+o.y*o.y+o.z*o.z)}S===v&&(R(i,r,l)>0?(p.faces.push(new THREE.Face3(0,2,1,y)),p.faces.push(new THREE.Face3(1,3,0,y))):(p.faces.push(new THREE.Face3(1,2,0,y)),p.faces.push(new THREE.Face3(0,3,1,y))));S===f&&(R(i,l,r)>0?(p.faces.push(new THREE.Face3(0,1,2,y)),p.faces.push(new THREE.Face3(2,3,0,y))):(p.faces.push(new THREE.Face3(0,3,2,y)),p.faces.push(new THREE.Face3(2,1,0,y))));S===w&&(R(i,c,r)>0?(p.faces.push(new THREE.Face3(0,1,3,y)),p.faces.push(new THREE.Face3(3,2,0,y))):(p.faces.push(new THREE.Face3(0,2,3,y)),p.faces.push(new THREE.Face3(3,1,0,y))));var $=new THREE.MeshLambertMaterial({color:16777215});$.transparent=!0,$.opacity=.8;var x=new THREE.Mesh(p,$);T=x.uuid,n.add(x),H=[],g=[],E=[]},deviceCoordinates:function(t){var e=new THREE.Vector3;return e.set((t.x-320)/(window.innerWidth-340)*2-1,-(t.y-70)/(window.innerHeight-90)*2+1,.5),e.unproject(a),e},screenCoordinates:function(t){t.project(a);var e={x:0,y:0};return e.x=Math.round((t.x+1)/2*(window.innerWidth-340)+320),e.y=Math.round((t.y-1)/2*-1*(window.innerHeight-90)+70),e},newDrawVideoHotSpotX:function(t,e){console.log(e);var o={},s=this,i=[];if(console.log(s.$store.state.test.videoGroup),4===s.$store.state.test.videoGroup.length)for(var r=0;r<4;r++)i.push(s.screenCoordinates(s.$store.state.test.videoGroup[r]));console.log(i);for(var l=0;l<4;l++)i[l].x+=e;this.$store.commit("emptyVideoGroup");for(var c=0;c<4;c++)o=m(i[c]),console.log(o),H.push(o.point.x),g.push(o.point.y),E.push(o.point.z);var p=this.screenCoordinates(t.vector);p.x+=e;var u=this.deviceCoordinates(p);this.$store.commit("saveOldselectedVector",u.clone());var h=function(t){var e=new THREE.Vector3;e.set((t.x-320)/(window.innerWidth-340)*2-1,-(t.y-70)/(window.innerHeight-90)*2+1,.5),e.unproject(a);var o=new THREE.Raycaster(a.position,e.sub(a.position).normalize());return o.set(a.position,e.sub(a.position).normalize()),o.intersectObjects(n.children)[0]}(p),d=[h.point.x,h.point.y,h.point.z];function m(t){var e=new THREE.Vector3;e.set((t.x-320)/(window.innerWidth-340)*2-1,-(t.y-70)/(window.innerHeight-90)*2+1,.5),e.unproject(a),s.$store.commit("saveVideoGroup",e);var o=new THREE.Raycaster(a.position,e.sub(a.position).normalize());return o.set(a.position,e.sub(a.position).normalize()),o.intersectObjects(n.children)[0]}this.$store.commit("saveOldselectedSelect",d);var v=new THREE.Vector3(H[0],g[0],E[0]),f=new THREE.Vector3(H[1],g[1],E[1]),w=new THREE.Vector3(H[2],g[2],E[2]),S=new THREE.Vector3(H[3],g[3],E[3]),y=new THREE.Geometry;y.vertices.push(v),y.vertices.push(f),y.vertices.push(w),y.vertices.push(S);var R=[H[0],g[0],E[0]],$=[H[1],g[1],E[1]],x=[H[2],g[2],E[2]],M=[H[3],g[3],E[3]],b=($[0]-R[0])*($[0]-R[0])+($[1]-R[1])*($[1]-R[1])+($[2]-R[2])*($[2]-R[2]),I=(x[0]-R[0])*(x[0]-R[0])+(x[1]-R[1])*(x[1]-R[1])+(x[2]-R[2])*(x[2]-R[2]),_=(M[0]-R[0])*(M[0]-R[0])+(M[1]-R[1])*(M[1]-R[1])+(M[2]-R[2])*(M[2]-R[2]),F=Math.max(b,I,_),z=y.computeFaceNormals();function U(t,e,o){var s=t.clone();return s.cross(e),s.normalize(),(s.x*o.x+s.y*o.y+s.z*o.z)/Math.sqrt(o.x*o.x+o.y*o.y+o.z*o.z)}F===b&&(U(v,f,w)>0?(y.faces.push(new THREE.Face3(0,2,1,z)),y.faces.push(new THREE.Face3(1,3,0,z))):(y.faces.push(new THREE.Face3(1,2,0,z)),y.faces.push(new THREE.Face3(0,3,1,z))));F===I&&(U(v,w,f)>0?(y.faces.push(new THREE.Face3(0,1,2,z)),y.faces.push(new THREE.Face3(2,3,0,z))):(y.faces.push(new THREE.Face3(0,3,2,z)),y.faces.push(new THREE.Face3(2,1,0,z))));F===_&&(U(v,S,f)>0?(y.faces.push(new THREE.Face3(0,1,3,z)),y.faces.push(new THREE.Face3(3,2,0,z))):(y.faces.push(new THREE.Face3(0,2,3,z)),y.faces.push(new THREE.Face3(3,1,0,z))));var L=new THREE.MeshLambertMaterial({color:16777215});L.transparent=!0,L.opacity=.8;var V=new THREE.Mesh(y,L);console.log("new:"),console.log(V),T=V.uuid,n.add(V),H=[],g=[],E=[]},newDrawVideoHotSpotY:function(t,e){console.log(e);var o={},s=this,i=[];if(console.log(s.$store.state.test.videoGroup),4===s.$store.state.test.videoGroup.length)for(var r=0;r<4;r++)i.push(s.screenCoordinates(s.$store.state.test.videoGroup[r]));console.log(i);for(var l=0;l<4;l++)i[l].y+=e;this.$store.commit("emptyVideoGroup");for(var c=0;c<4;c++)o=m(i[c]),console.log(o),H.push(o.point.x),g.push(o.point.y),E.push(o.point.z);var p=this.screenCoordinates(t.vector);p.y+=e;var u=this.deviceCoordinates(p);this.$store.commit("saveOldselectedVector",u.clone());var h=function(t){var e=new THREE.Vector3;e.set((t.x-320)/(window.innerWidth-340)*2-1,-(t.y-70)/(window.innerHeight-90)*2+1,.5),e.unproject(a);var o=new THREE.Raycaster(a.position,e.sub(a.position).normalize());return o.set(a.position,e.sub(a.position).normalize()),o.intersectObjects(n.children)[0]}(p),d=[h.point.x,h.point.y,h.point.z];function m(t){var e=new THREE.Vector3;e.set((t.x-320)/(window.innerWidth-340)*2-1,-(t.y-70)/(window.innerHeight-90)*2+1,.5),e.unproject(a),s.$store.commit("saveVideoGroup",e);var o=new THREE.Raycaster(a.position,e.sub(a.position).normalize());return o.set(a.position,e.sub(a.position).normalize()),o.intersectObjects(n.children)[0]}this.$store.commit("saveOldselectedSelect",d);var v=new THREE.Vector3(H[0],g[0],E[0]),f=new THREE.Vector3(H[1],g[1],E[1]),w=new THREE.Vector3(H[2],g[2],E[2]),S=new THREE.Vector3(H[3],g[3],E[3]),y=new THREE.Geometry;y.vertices.push(v),y.vertices.push(f),y.vertices.push(w),y.vertices.push(S);var R=[H[0],g[0],E[0]],$=[H[1],g[1],E[1]],x=[H[2],g[2],E[2]],M=[H[3],g[3],E[3]],b=($[0]-R[0])*($[0]-R[0])+($[1]-R[1])*($[1]-R[1])+($[2]-R[2])*($[2]-R[2]),I=(x[0]-R[0])*(x[0]-R[0])+(x[1]-R[1])*(x[1]-R[1])+(x[2]-R[2])*(x[2]-R[2]),_=(M[0]-R[0])*(M[0]-R[0])+(M[1]-R[1])*(M[1]-R[1])+(M[2]-R[2])*(M[2]-R[2]),F=Math.max(b,I,_),z=y.computeFaceNormals();function U(t,e,o){var s=t.clone();return s.cross(e),s.normalize(),(s.x*o.x+s.y*o.y+s.z*o.z)/Math.sqrt(o.x*o.x+o.y*o.y+o.z*o.z)}F===b&&(U(v,f,w)>0?(y.faces.push(new THREE.Face3(0,2,1,z)),y.faces.push(new THREE.Face3(1,3,0,z))):(y.faces.push(new THREE.Face3(1,2,0,z)),y.faces.push(new THREE.Face3(0,3,1,z))));F===I&&(U(v,w,f)>0?(y.faces.push(new THREE.Face3(0,1,2,z)),y.faces.push(new THREE.Face3(2,3,0,z))):(y.faces.push(new THREE.Face3(0,3,2,z)),y.faces.push(new THREE.Face3(2,1,0,z))));F===_&&(U(v,S,f)>0?(y.faces.push(new THREE.Face3(0,1,3,z)),y.faces.push(new THREE.Face3(3,2,0,z))):(y.faces.push(new THREE.Face3(0,2,3,z)),y.faces.push(new THREE.Face3(3,1,0,z))));var L=new THREE.MeshLambertMaterial({color:16777215});L.transparent=!0,L.opacity=.8;var V=new THREE.Mesh(y,L);console.log("new:"),console.log(V),T=V.uuid,n.add(V),H=[],g=[],E=[]},newDrawVideoHotSpotR:function(t,e){var o={},s=this,i=[];if(4===s.$store.state.test.videoGroup.length)for(var r=0;r<4;r++)i.push(s.screenCoordinates(s.$store.state.test.videoGroup[r]));console.log(i);var l=this.screenCoordinates(t.vector);console.log(l);var c=this.deviceCoordinates(l);this.$store.commit("saveOldselectedVector",c.clone());var p=function(t){var e=new THREE.Vector3;e.set((t.x-320)/(window.innerWidth-340)*2-1,-(t.y-70)/(window.innerHeight-90)*2+1,.5),e.unproject(a);var o=new THREE.Raycaster(a.position,e.sub(a.position).normalize());return o.set(a.position,e.sub(a.position).normalize()),o.intersectObjects(n.children)[0]}(l),u=[p.point.x,p.point.y,p.point.z];this.$store.commit("saveOldselectedSelect",u);for(var h=[],d=0;d<i.length;d++){var m={};m.x=i[d].x-l.x,m.y=i[d].y-l.y,h.push(m)}console.log(h),console.log(i),this.$store.commit("emptyVideoGroup");for(var v=0;v<4;v++)o=f(i[v]),H.push(o.point.x),g.push(o.point.y),E.push(o.point.z);function f(t){var e=new THREE.Vector3;e.set((t.x-320)/(window.innerWidth-340)*2-1,-(t.y-70)/(window.innerHeight-90)*2+1,.5),e.unproject(a),s.$store.commit("saveVideoGroup",e);var o=new THREE.Raycaster(a.position,e.sub(a.position).normalize());return o.set(a.position,e.sub(a.position).normalize()),o.intersectObjects(n.children)[0]}var w=new THREE.Vector3(H[0],g[0],E[0]),S=new THREE.Vector3(H[1],g[1],E[1]),y=new THREE.Vector3(H[2],g[2],E[2]),R=new THREE.Vector3(H[3],g[3],E[3]),$=new THREE.Geometry;$.vertices.push(w),$.vertices.push(S),$.vertices.push(y),$.vertices.push(R);var x=[H[0],g[0],E[0]],M=[H[1],g[1],E[1]],b=[H[2],g[2],E[2]],I=[H[3],g[3],E[3]],_=(M[0]-x[0])*(M[0]-x[0])+(M[1]-x[1])*(M[1]-x[1])+(M[2]-x[2])*(M[2]-x[2]),F=(b[0]-x[0])*(b[0]-x[0])+(b[1]-x[1])*(b[1]-x[1])+(b[2]-x[2])*(b[2]-x[2]),z=(I[0]-x[0])*(I[0]-x[0])+(I[1]-x[1])*(I[1]-x[1])+(I[2]-x[2])*(I[2]-x[2]),U=Math.max(_,F,z),L=$.computeFaceNormals();function V(t,e,o){var s=t.clone();return s.cross(e),s.normalize(),(s.x*o.x+s.y*o.y+s.z*o.z)/Math.sqrt(o.x*o.x+o.y*o.y+o.z*o.z)}U===_&&(V(w,S,y)>0?($.faces.push(new THREE.Face3(0,2,1,L)),$.faces.push(new THREE.Face3(1,3,0,L))):($.faces.push(new THREE.Face3(1,2,0,L)),$.faces.push(new THREE.Face3(0,3,1,L))));U===F&&(V(w,y,S)>0?($.faces.push(new THREE.Face3(0,1,2,L)),$.faces.push(new THREE.Face3(2,3,0,L))):($.faces.push(new THREE.Face3(0,3,2,L)),$.faces.push(new THREE.Face3(2,1,0,L))));U===z&&(V(w,R,S)>0?($.faces.push(new THREE.Face3(0,1,3,L)),$.faces.push(new THREE.Face3(3,2,0,L))):($.faces.push(new THREE.Face3(0,2,3,L)),$.faces.push(new THREE.Face3(3,1,0,L))));var C=new THREE.MeshLambertMaterial({color:16777215});C.transparent=!0,C.opacity=.8;var j=new THREE.Mesh($,C);console.log("new:"),console.log(j),T=j.uuid,n.add(j),H=[],g=[],E=[]},newDrawVideoHotSpotS:function(t,e){console.log(e);var o={},s=this,i=[];if(console.log(s.$store.state.test.videoGroup),4===s.$store.state.test.videoGroup.length)for(var r=0;r<4;r++)i.push(s.screenCoordinates(s.$store.state.test.videoGroup[r]));console.log(i);for(var l=0;l<4;l++)i[l].y+=e;this.$store.commit("emptyVideoGroup");for(var c=0;c<4;c++)o=m(i[c]),console.log(o),H.push(o.point.x),g.push(o.point.y),E.push(o.point.z);var p=this.screenCoordinates(t.vector);p.y+=e;var u=this.deviceCoordinates(p);this.$store.commit("saveOldselectedVector",u.clone());var h=function(t){var e=new THREE.Vector3;e.set((t.x-320)/(window.innerWidth-340)*2-1,-(t.y-70)/(window.innerHeight-90)*2+1,.5),e.unproject(a);var o=new THREE.Raycaster(a.position,e.sub(a.position).normalize());return o.set(a.position,e.sub(a.position).normalize()),o.intersectObjects(n.children)[0]}(p),d=[h.point.x,h.point.y,h.point.z];function m(t){var e=new THREE.Vector3;e.set((t.x-320)/(window.innerWidth-340)*2-1,-(t.y-70)/(window.innerHeight-90)*2+1,.5),e.unproject(a),s.$store.commit("saveVideoGroup",e);var o=new THREE.Raycaster(a.position,e.sub(a.position).normalize());return o.set(a.position,e.sub(a.position).normalize()),o.intersectObjects(n.children)[0]}this.$store.commit("saveOldselectedSelect",d);var v=new THREE.Vector3(H[0],g[0],E[0]),f=new THREE.Vector3(H[1],g[1],E[1]),w=new THREE.Vector3(H[2],g[2],E[2]),S=new THREE.Vector3(H[3],g[3],E[3]),y=new THREE.Geometry;y.vertices.push(v),y.vertices.push(f),y.vertices.push(w),y.vertices.push(S);var R=[H[0],g[0],E[0]],$=[H[1],g[1],E[1]],x=[H[2],g[2],E[2]],M=[H[3],g[3],E[3]],b=($[0]-R[0])*($[0]-R[0])+($[1]-R[1])*($[1]-R[1])+($[2]-R[2])*($[2]-R[2]),I=(x[0]-R[0])*(x[0]-R[0])+(x[1]-R[1])*(x[1]-R[1])+(x[2]-R[2])*(x[2]-R[2]),_=(M[0]-R[0])*(M[0]-R[0])+(M[1]-R[1])*(M[1]-R[1])+(M[2]-R[2])*(M[2]-R[2]),F=Math.max(b,I,_),z=y.computeFaceNormals();function U(t,e,o){var s=t.clone();return s.cross(e),s.normalize(),(s.x*o.x+s.y*o.y+s.z*o.z)/Math.sqrt(o.x*o.x+o.y*o.y+o.z*o.z)}F===b&&(U(v,f,w)>0?(y.faces.push(new THREE.Face3(0,2,1,z)),y.faces.push(new THREE.Face3(1,3,0,z))):(y.faces.push(new THREE.Face3(1,2,0,z)),y.faces.push(new THREE.Face3(0,3,1,z))));F===I&&(U(v,w,f)>0?(y.faces.push(new THREE.Face3(0,1,2,z)),y.faces.push(new THREE.Face3(2,3,0,z))):(y.faces.push(new THREE.Face3(0,3,2,z)),y.faces.push(new THREE.Face3(2,1,0,z))));F===_&&(U(v,S,f)>0?(y.faces.push(new THREE.Face3(0,1,3,z)),y.faces.push(new THREE.Face3(3,2,0,z))):(y.faces.push(new THREE.Face3(0,2,3,z)),y.faces.push(new THREE.Face3(3,1,0,z))));var L=new THREE.MeshLambertMaterial({color:16777215});L.transparent=!0,L.opacity=.8;var V=new THREE.Mesh(y,L);console.log("new:"),console.log(V),T=V.uuid,n.add(V),H=[],g=[],E=[]}}},R={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"panoramaContent",attrs:{id:"container"}})},staticRenderFns:[]};var $,x=o("VU/8")(y,R,!1,function(t){o("epUy")},"data-v-1e265579",null).exports,M="",b="",I="",_="",F=[],z=[],U=[],L=[],V=[],C=[],j=!1,P=0,N=0,A=0,k=0,D=0,G=0,q=0,J=0,O=new THREE.Vector3,W={name:"cube-faces",computed:{imgUrl:function(){return this.$store.state.test.imgFile.tempfileUrl},isSubmit:function(){var t=this.$store.state.test.isSubmit;return t}},watch:{imgUrl:function(t){document.getElementById("container").innerHTML="",this.init(t),this.animate()},isSubmit:function(){for(var t=M.children,e=[],o=0,s=t.length;o<s;o++)"sprite"===t[o].type.toLowerCase()&&(e.push(t[o].addition),e.push(t[o]));this.$store.dispatch("hotSpots",{sprites:e})}},mounted:function(){this.init(this.imgUrl),this.animate()},methods:{init:function(t){if(1===t.length){var e=document.getElementById("container");(I=new THREE.WebGLRenderer).setPixelRatio(window.devicePixelRatio),I.setSize(window.innerWidth,window.innerHeight),e.appendChild(I.domElement),M=new THREE.Scene,(b=new THREE.PerspectiveCamera(90,(window.innerWidth-340)/(window.innerHeight-90),.1,100)).position.z=.01,(_=new THREE.OrbitControls(b,I.domElement)).enableZoom=!1,_.enablePan=!1,_.enableDamping=!0,_.rotateSpeed=-.25;var o=this.getTexturesFromAtlasFile(t[0],6);console.log(o);for(var s=[],i=0;i<6;i++)s.push(new THREE.MeshBasicMaterial({map:o[i]}));var n=new THREE.Mesh(new THREE.CubeGeometry(1,1,1),s);n.geometry.scale(1,1,-1),M.add(n),window.addEventListener("resize",this.onWindowResize,!1)}else if(6===t.length){var a;e=document.getElementById("container"),b=new THREE.PerspectiveCamera(75,(window.innerWidth-340)/(window.innerHeight-90),1,1100),M=new THREE.Scene,($=document.createElement("canvas")).width=128,$.height=128;var r=$.getContext("2d");r.fillStyle="rgb( 200, 200, 200 )",r.fillRect(0,0,$.width,$.height);s=[this.loadTexture(t[0]),this.loadTexture(t[1]),this.loadTexture(t[2]),this.loadTexture(t[3]),this.loadTexture(t[4]),this.loadTexture(t[5])];var l=new THREE.BoxGeometry(300,300,300,7,7,7);l.scale(-1,1,1),a=new THREE.Mesh(l,s),M.add(a);var c=new THREE.SphereGeometry(500,30,20);c.scale(-1,1,1);var p=new THREE.MeshBasicMaterial({color:16777215}),u=new THREE.Mesh(c,p);u.material.transparent=!0,u.material.opacity=0,M.add(u),(I=new THREE.CanvasRenderer).setPixelRatio(window.devicePixelRatio),I.setSize(window.innerWidth-340,window.innerHeight-90),e.appendChild(I.domElement),document.addEventListener("mousedown",this.onDocumentMouseDown,!1),document.addEventListener("mousemove",this.onDocumentMouseMove,!1),document.addEventListener("mouseup",this.onDocumentMouseUp,!1),document.addEventListener("wheel",this.onDocumentMouseWheel,!1),window.addEventListener("resize",this.onWindowResize,!1)}},getTexturesFromAtlasFile:function(t,e){for(var o=[],s=0;s<e;s++)o[s]=new THREE.Texture;var i=new Image;return i.onload=function(){for(var t,e,s=i.height,n=0;n<o.length;n++)e=(t=document.createElement("canvas")).getContext("2d"),t.height=s,t.width=s,e.drawImage(i,s*n,0,s,s,0,0,s,s),o[n].image=t,o[n].needsUpdate=!0},i.src=t,o},onWindowResize:function(){b.aspect=(window.innerWidth-340)/(window.innerHeight-90),b.updateProjectionMatrix(),I.setSize(window.innerWidth-340,window.innerHeight-90)},animate:function(){1===this.imgUrl.length?(requestAnimationFrame(this.animate),_.update(),I.render(M,b)):6===this.imgUrl.length&&(this.update(),requestAnimationFrame(this.animate))},loadTexture:function(t){var e=new THREE.Texture($),o=new THREE.MeshBasicMaterial({map:e,overdraw:.5}),s=new Image;return s.onload=function(){e.image=this,e.needsUpdate=!0},s.src=t,o},onDocumentMouseDown:function(t){if("Cube Faces"===this.$store.state.test.imgType){t.preventDefault();var e=new THREE.Vector3;e.set((t.clientX-320)/(window.innerWidth-340)*2-1,-(t.clientY-70)/(window.innerHeight-90)*2+1,.5),e.unproject(b);var o=new THREE.Raycaster(b.position,e.sub(b.position).normalize()).intersectObjects(M.children);if(this.$store.state.test.isHotspot){if(o.length>0){var s=o[1];L.push(Number(s.point.x)),V.push(Number(s.point.y)),C.push(Number(s.point.z));var i=o[0];F.push(i.point.x),z.push(i.point.y),U.push(i.point.z)}if(3==F.length){document.getElementById("container").style.cursor="default",this.$store.dispatch("isHotspot");var n=(F[0]+F[1]+F[2])/3,a=(z[0]+z[1]+z[2])/3,r=(U[0]+U[1]+U[2])/3,l=(C[0]+C[1]+C[2])/3,c=(V[0]+V[1]+V[2])/3,p=(L[0]+L[1]+L[2])/3,u=document.createElement("canvas");u.style.backgroundColor="rgba(255,255,255,0)";var h=u.getContext("2d");u.width=128,u.height=128;var d=new Image;d.src="static/textures/hotspot.svg";var m=this;d.onload=function(){h.drawImage(d,0,0);var t=new THREE.Texture(u);t.needsUpdate=!0,t.minFilter=THREE.LinearFilter;var e=new THREE.SpriteMaterial({map:t,transparent:!1}),o=new THREE.Sprite(e);o.scale.set(18,18,18);var s=new THREE.Vector3(.8*n,.8*a,.8*r);o.position.copy(s),o.addition=m.calculatePanandTilt(-l,c,p),M.add(o)},L=[],V=[],C=[],F=[],z=[],U=[]}}else if(o.length>0){var v=o[0];try{v.object&&v.object.type.length>0&&"sprite"==v.object.type.toLowerCase()&&M.remove(v.object)}catch(t){console.log(t)}}}j=!0,P=t.clientX,N=t.clientY,k=A,G=D},onDocumentMouseMove:function(t){!0===j&&(A=.1*(P-t.clientX)+k,D=.1*(t.clientY-N)+G)},onDocumentMouseUp:function(t){j=!1},onDocumentMouseWheel:function(t){var e=b.fov+.05*t.deltaY;b.fov=THREE.Math.clamp(e,10,75),b.updateProjectionMatrix()},update:function(){!1===j&&(A+=0),D=Math.max(-85,Math.min(85,D)),q=THREE.Math.degToRad(90-D),J=THREE.Math.degToRad(A),O.x=500*Math.sin(q)*Math.cos(J),O.y=500*Math.cos(q),O.z=500*Math.sin(q)*Math.sin(J),b.lookAt(O),I.render(M,b)},calculatePanandTilt:function(t,e,o){var s=0;return-t>0&&o<=0&&(s=180*Math.atan(o/-t)/Math.PI),-t<0&&o<0&&(s=180*Math.atan(o/-t)/Math.PI-180),-t>0&&o>=0&&(s=180*Math.atan(o/-t)/Math.PI),-t<0&&o>0&&(s=180+180*Math.atan(o/-t)/Math.PI),[s,180*Math.asin(e/500)/Math.PI]}}},X={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"panoramaContent",attrs:{id:"container"}})},staticRenderFns:[]};var B=o("VU/8")(W,X,!1,function(t){o("qW1i")},"data-v-2988a35c",null).exports,Y="",K="",Q="",Z=!1,tt=0,et=0,ot="",st="",it="",nt="",at=0,rt=0,lt=[],ct=[],pt=[],ut={name:"cylindrical",computed:{imgUrl:function(){return this.$store.state.test.imgFile.fileUrl},isSubmit:function(){var t=this.$store.state.test.isSubmit;return t},drawedHotspots:function(){for(var t=this.$store.state.test.sum,e=0;e<t.length;e++){if(t[e].imgFile.fileUrl[0]==this.imgUrl)return t[e].hotSpots}return[]},drawedImgHotSpots:function(){for(var t=this.$store.state.test.sum,e=0;e<t.length;e++){if(t[e].imgFile.fileUrl[0]==this.imgUrl)return t[e].imgHotSpots}return[]}},watch:{imgUrl:function(t){document.getElementById("container").innerHTML="",this.$store.commit("clearTarget"),this.$store.commit("clearHotSpots"),this.$store.commit("clearHotUrl"),this.$store.commit("clearImgHotSpots"),this.init(t),this.animate()},isSubmit:function(){for(var t=Y.children,e=[],o=[],s=this.$store.state.test.target,i=this.$store.state.test.hotUrl,n=0,a=0,r=0,l=t.length;r<l;r++){if("sprite"===t[r].type.toLowerCase()){var c=this.calculatePanandTilt(1.25*t[r].position.x,1.25*t[r].position.y,1.25*t[r].position.z);o.push({panAndTilt:c,position:[1.25*t[r].position.x,1.25*t[r].position.y,1.25*t[r].position.z],target:s[n++]})}if("meshnormalmaterial"===t[r].material.type.toLowerCase()){for(var p=[],u=0,h=t[r].geometry.vertices.length;u<h;u++)p.push(this.calculatePanandTilt(t[r].geometry.vertices[u].x,t[r].geometry.vertices[u].y,t[r].geometry.vertices[u].z));e.push({panAndTilt:p,position:t[r].geometry.vertices,target:null,hotUrl:i[a++]})}}this.$store.dispatch("hotSpots",{sprites:o}),this.$store.dispatch("imgHotSpots",{imgHotSpots:e})}},mounted:function(){this.init(this.imgUrl),this.animate()},methods:{init:function(t){if(t.length>1)alert("抱歉，一张图请选择panorama1，六张图请选择panorama6且只支持cubeFaces");else{var e,o="";o=document.getElementById("container"),Y=new THREE.Scene,(K=new THREE.PerspectiveCamera(75,(window.innerWidth-340)/(window.innerHeight-90),1,1100)).target=new THREE.Vector3(0,0,0);var s=new THREE.CylinderGeometry(500,500,500*Math.PI,60,40);s.scale(-1,1,1);var i=new THREE.MeshBasicMaterial({map:(new THREE.TextureLoader).load(t[0])});e=new THREE.Mesh(s,i),Y.add(e);for(var n=this.drawedHotspots,a=function(t,e){var o=n[t].position,s=document.createElement("canvas");s.style.backgroundColor="rgba(255,255,255,0)";var i=s.getContext("2d");s.width=128,s.height=128,(c=new Image).src="static/textures/hotspot.svg",c.onload=function(){i.drawImage(c,0,0);var t=new THREE.Texture(s);t.needsUpdate=!0,t.minFilter=THREE.LinearFilter;var e=new THREE.SpriteMaterial({map:t,transparent:!1}),n=new THREE.Sprite(e);n.scale.set(30,30,30);var a=new THREE.Vector3(.8*o[0],.8*o[1],.8*o[2]);n.position.copy(a),Y.add(n)}},r=0,l=n.length;r<l;r++){var c;a(r)}var p=this.drawedImgHotSpots,u=0;for(l=p.length;u<l;u++){var h=p[u].position,d=new THREE.Vector3(h[0].x,h[0].y,h[0].z),m=new THREE.Vector3(h[1].x,h[1].y,h[1].z),v=new THREE.Vector3(h[2].x,h[2].y,h[2].z),f=new THREE.Vector3(h[3].x,h[3].y,h[3].z),H=new THREE.Geometry;H.vertices.push(d),H.vertices.push(m),H.vertices.push(v),H.vertices.push(f),H.faces.push(new THREE.Face3(0,1,2)),H.faces.push(new THREE.Face3(2,3,0)),H.computeFaceNormals();var g=new THREE.Mesh(H,new THREE.MeshNormalMaterial);Y.add(g)}(Q=new THREE.WebGLRenderer).setPixelRatio(window.devicePixelRatio),Q.setSize(window.innerWidth-340,window.innerHeight-90),o.appendChild(Q.domElement),document.getElementsByTagName("canvas")[0].addEventListener("mousedown",this.onDocumentMouseDown,!1),document.getElementsByTagName("canvas")[0].addEventListener("mousemove",this.onDocumentMouseMove,!1),document.getElementsByTagName("canvas")[0].addEventListener("mouseup",this.onDocumentMouseUp,!1),document.getElementsByTagName("canvas")[0].addEventListener("wheel",this.onDocumentMouseWheel,!1),window.addEventListener("resize",this.onWindowResize,!1)}},onWindowResize:function(){K.aspect=(window.innerWidth-340)/(window.innerHeight-90),K.updateProjectionMatrix(),Q.setSize(window.innerWidth-340,window.innerHeight-90)},onDocumentMouseDown:function(t){if("Cylindrical"===this.$store.state.test.imgType){t.preventDefault();var e=new THREE.Vector3;e.set((t.clientX-320)/(window.innerWidth-340)*2-1,-(t.clientY-70)/(window.innerHeight-90)*2+1,.5),e.unproject(K);var o=new THREE.Raycaster(K.position,e.sub(K.position).normalize()).intersectObjects(Y.children);if(this.$store.state.test.isHotspot){if(o.length>0){var s=o[0];console.log(o),lt.push(s.point.x),ct.push(s.point.y),pt.push(s.point.z)}if(3==lt.length){document.getElementById("container").style.cursor="default",this.$store.dispatch("isHotspot");var i=(lt[0]+lt[1]+lt[2])/3,n=(ct[0]+ct[1]+ct[2])/3,a=(pt[0]+pt[1]+pt[2])/3,r=document.createElement("canvas");r.style.backgroundColor="rgba(255,255,255,0)";var l=r.getContext("2d");r.width=128,r.height=128;var c=new Image;c.src="static/textures/hotspot.svg",c.onload=function(){l.drawImage(c,0,0);var t=new THREE.Texture(r);t.needsUpdate=!0,t.minFilter=THREE.LinearFilter;var e=new THREE.SpriteMaterial({map:t,transparent:!1}),o=new THREE.Sprite(e);o.scale.set(30,30,30);var s=new THREE.Vector3(.8*i,.8*n,.8*a);o.position.copy(s),Y.add(o)},lt=[],ct=[],pt=[]}}else if(o.length>0){var p=o[0];try{p.object&&p.object.type.length>0&&"sprite"==p.object.type.toLowerCase()&&Y.remove(p.object)}catch(t){console.log(t)}}if(this.$store.state.test.isImageHotspot){if(o.length>0){(s=o[0]).point;lt.push(s.point.x),ct.push(s.point.y),pt.push(s.point.z)}if(1==lt.length){var u=new THREE.Geometry,h=new THREE.PointsMaterial({color:255,size:10});u.vertices.push(new THREE.Vector3(lt[0],ct[0],pt[0]));var d=new THREE.Points(u,h);Y.add(d)}if(2==lt.length){var m=new THREE.Geometry,v=new THREE.ParticleBasicMaterial({color:255,size:10});m.vertices.push(new THREE.Vector3(lt[1],ct[1],pt[1]));var f=new THREE.Points(m,v);Y.add(f);var H=new THREE.Geometry;H.vertices.push(new THREE.Vector3(lt[0],ct[0],pt[0])),H.vertices.push(new THREE.Vector3(lt[1],ct[1],pt[1]));var g=new THREE.Line(H,v,THREE.LineSegments);Y.add(g)}if(3==lt.length){var E=new THREE.Geometry,w=new THREE.ParticleBasicMaterial({color:255,size:10});E.vertices.push(new THREE.Vector3(lt[2],ct[2],pt[2]));var S=new THREE.Points(E,w);Y.add(S);var T=new THREE.Geometry;T.vertices.push(new THREE.Vector3(lt[1],ct[1],pt[1])),T.vertices.push(new THREE.Vector3(lt[2],ct[2],pt[2]));var y=new THREE.Line(T,w,THREE.LineSegments);Y.add(y);var R=new THREE.Geometry;R.vertices.push(new THREE.Vector3(lt[2],ct[2],pt[2])),R.vertices.push(new THREE.Vector3(lt[0],ct[0],pt[0]));var $=new THREE.Line(R,w,THREE.LineSegments);Y.add($)}if(4==lt.length){document.getElementById("container").style.cursor="default",this.$store.dispatch("isImageHotspot");for(var x=Y.children,M=0;M<x.length;M++)"points"!==x[M].type.toLowerCase()&&"line"!==x[M].type.toLowerCase()||(Y.remove(x[M]),M--);var b=new THREE.Vector3(lt[0],ct[0],pt[0]),I=new THREE.Vector3(lt[1],ct[1],pt[1]),_=new THREE.Vector3(lt[2],ct[2],pt[2]),F=new THREE.Vector3(lt[3],ct[3],pt[3]),z=new THREE.Geometry;z.vertices.push(b),z.vertices.push(I),z.vertices.push(_),z.vertices.push(F),z.faces.push(new THREE.Face3(0,1,2)),z.faces.push(new THREE.Face3(2,3,0)),z.computeFaceNormals();var U=new THREE.Mesh(z,new THREE.MeshNormalMaterial);Y.add(U),lt=[],ct=[],pt=[],console.log(Y)}}else if(o.length>0){var L=o[0];try{L.object&&L.object.type.length>0&&"meshnormalmaterial"==L.object.material.type.toLowerCase()&&Y.remove(L.object)}catch(t){console.log(t)}}}Z=!0,ot=t.clientX,it=t.clientY,st=tt,nt=et},onDocumentMouseMove:function(t){!0===Z&&(tt=.1*(ot-t.clientX)+st,et=.1*(t.clientY-it)+nt)},onDocumentMouseUp:function(){Z=!1},onDocumentMouseWheel:function(t){K.fov+=.05*t.deltaY,K.fov>=10&&K.fov<=150&&K.updateProjectionMatrix()},animate:function(){this.imgUrl.length>1||(this.update(),requestAnimationFrame(this.animate))},update:function(){!1===Z&&(tt+=0),et=Math.max(-85,Math.min(85,et)),at=THREE.Math.degToRad(90-et),rt=THREE.Math.degToRad(tt),K.target.x=500*Math.sin(at)*Math.cos(rt),K.target.y=500*Math.cos(at),K.target.z=500*Math.sin(at)*Math.sin(rt),K.lookAt(K.target),Q.render(Y,K)},calculatePanandTilt:function(t,e,o){var s,i=0;return t<0&&o<0&&(i=180*Math.asin(-t/500)/Math.PI),t>0&&o<0&&(i=180*Math.asin(-t/500)/Math.PI),t>0&&o>=0&&(i=180*Math.asin(t/500)/Math.PI-180),t<0&&o>0&&(i=180*Math.asin(t/500)/Math.PI+180),s=180*Math.atan(e/500)/Math.PI,console.log("pan: "+i),console.log("tilt: "+s),[i,s]}}},ht={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"panoramaContent",attrs:{id:"container"}})},staticRenderFns:[]};var dt=o("VU/8")(ut,ht,!1,function(t){o("uPOW")},"data-v-8e2de330",null).exports,mt="",vt="",ft="",Ht=[],gt=[],Et=[],wt=null,St=!1,Tt=0,yt=0,Rt={name:"flat",computed:{imgUrl:function(){return this.$store.state.test.imgFile.fileUrl},isSubmit:function(){var t=this.$store.state.test.isSubmit;return t},drawedHotspots:function(){for(var t=this.$store.state.test.sum,e=0;e<t.length;e++){if(t[e].imgFile.fileUrl[0]==this.imgUrl)return t[e].hotSpots}return[]}},watch:{imgUrl:function(t){document.getElementById("container").innerHTML="",this.$store.commit("clearTarget"),this.$store.commit("clearHotSpots"),this.$store.commit("clearHotUrl"),this.$store.commit("clearImgHotSpots"),this.init(t),this.animate()},isSubmit:function(){for(var t=mt.children,e=this.$store.state.test.target,o=[],s=0,i=0,n=t.length;i<n;i++)if("sprite"===t[i].type.toLowerCase()){var a=[2.5*-t[i].position.x,2.5*t[i].position.y],r=[t[i].position.x,t[i].position.y];o.push({panAndTilt:a,position:r,target:e[s++]})}this.$store.dispatch("hotSpots",{sprites:o})}},mounted:function(){this.init(this.imgUrl),this.animate()},methods:{init:function(t){if(t.length>1)alert("抱歉，一张图请选择panorama1，六张图请选择panorama6且只支持cubeFaces");else{var e="";e=document.getElementById("container"),mt=new THREE.Scene,(vt=new THREE.PerspectiveCamera(75,(window.innerWidth-340)/(window.innerHeight-90),.1,600)).target=new THREE.Vector3(0,0,1),vt.position.z=37;var o=new THREE.PlaneGeometry(80,40),s=new THREE.MeshBasicMaterial({map:(new THREE.TextureLoader).load(t[0])});wt=new THREE.Mesh(o,s),mt.add(wt);for(var i=this.drawedHotspots,n=function(t,e){var o=i[t].position,s=document.createElement("canvas");s.style.backgroundColor="rgba(255,255,255,0)";var n=s.getContext("2d");s.width=128,s.height=128;var a=new Image;a.src="static/textures/hotspot.svg",a.onload=function(){n.drawImage(a,0,0);var t=new THREE.Texture(s);t.needsUpdate=!0,t.minFilter=THREE.LinearFilter;var e=new THREE.SpriteMaterial({map:t,transparent:!1}),i=new THREE.Sprite(e);i.scale.set(2,2,2);var r=new THREE.Vector3(1*o[0],1*o[1],1e-5);i.position.copy(r),mt.add(i)}},a=0,r=i.length;a<r;a++)n(a);(ft=new THREE.WebGLRenderer).setPixelRatio(window.devicePixelRatio),ft.setSize(window.innerWidth-340,window.innerHeight-90),e.appendChild(ft.domElement),document.getElementsByTagName("canvas")[0].addEventListener("wheel",this.onDocumentMouseWheel,!1),window.addEventListener("resize",this.onWindowResize,!1),document.getElementsByTagName("canvas")[0].addEventListener("mousedown",this.onDocumentMouseDown,!1)}},onDocumentMouseDown:function(t){if("Flat"===this.$store.state.test.imgType){t.preventDefault();var e=new THREE.Vector3;e.set((t.clientX-320)/(window.innerWidth-340)*2-1,-(t.clientY-70)/(window.innerHeight-90)*2+1,.5),e.unproject(vt);var o=new THREE.Raycaster(vt.position,e.sub(vt.position).normalize()).intersectObjects(mt.children);if(this.$store.state.test.isHotspot){if(o.length>0){var s=o[0];console.log(o);s.point;Ht.push(s.point.x),gt.push(s.point.y),Et.push(s.point.z)}if(3==Ht.length){document.getElementById("container").style.cursor="default",this.$store.dispatch("isHotspot");var i=(Ht[0]+Ht[1]+Ht[2])/3,n=(gt[0]+gt[1]+gt[2])/3,a=(Et[0]+Et[1]+Et[2])/3;console.log("xAverage:"+i+" yAverage: "+n+"zAverage: "+a);var r=document.createElement("canvas");r.style.backgroundColor="rgba(255,255,255,0)";var l=r.getContext("2d");r.width=128,r.height=128;var c=new Image;c.src="static/textures/hotspot.svg",c.onload=function(){l.drawImage(c,0,0);var t=new THREE.Texture(r);t.needsUpdate=!0,t.minFilter=THREE.LinearFilter;var e=new THREE.SpriteMaterial({map:t,transparent:!1}),o=new THREE.Sprite(e);o.scale.set(2,2,2);var s=new THREE.Vector3(1*i,1*n,1e-5);o.position.copy(s),mt.add(o)},Ht=[],gt=[],Et=[]}}else if(o.length>0){var p=o[0];try{p.object&&p.object.type.length>0&&"sprite"==p.object.type.toLowerCase()&&mt.remove(p.object)}catch(t){console.log(t)}}}St=!0,Tt=t.clientX,yt},onDocumentMouseMove:function(t){!0===St&&(yt=.1*(Tt-t.clientX),wt.position.x=-yt)},onDocumentMouseUp:function(){St=!1},onWindowResize:function(){vt.aspect=window.innerWidth/window.innerHeight,vt.updateProjectionMatrix(),ft.setSize(window.innerWidth,window.innerHeight)},onDocumentMouseWheel:function(t){vt.fov+=.05*t.deltaY,vt.fov>=10&&vt.fov<=150&&vt.updateProjectionMatrix()},animate:function(){this.imgUrl.length>1||(this.update(),requestAnimationFrame(this.animate))},update:function(){vt.lookAt(vt.target),ft.render(mt,vt)}}},$t={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"panoramaContent",attrs:{id:"container"}})},staticRenderFns:[]};var xt={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{attrs:{id:"inputbox"}},[o("h4",[t._v("新建项目")]),t._v(" "),o("input",{directives:[{name:"model",rawName:"v-model",value:t.shortName,expression:"shortName"}],attrs:{placeholder:"请输入项目名称"},domProps:{value:t.shortName},on:{input:function(e){e.target.composing||(t.shortName=e.target.value)}}}),t._v(" "),o("div",{staticClass:"queryBox"},[o("input",{attrs:{id:"queryInput",placeholder:"输入公司位置打开地图"}}),t._v(" "),o("el-button",{attrs:{type:"primary",plain:"",id:"startQuery"}},[t._v("搜索")]),t._v(" "),t._m(0)],1),t._v(" "),t._m(1),t._v(" "),o("input",{attrs:{type:"hidden",id:"latitude"}}),t._v(" "),o("input",{attrs:{type:"hidden",id:"longitude"}})])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"companyName"},[e("input",{attrs:{type:"button",id:"submitSite",value:"提交"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"mapBox mb1"},[e("div",{attrs:{id:"mapcontainer"}})])}]};var Mt={components:{Flat:o("VU/8")(Rt,$t,!1,function(t){o("ryf9")},"data-v-61159774",null).exports,Cylindrical:dt,CubeFaces:B,Equirectangular:x,AddProject:o("VU/8")({name:"add-project"},xt,!1,function(t){o("CjGi")},"data-v-619960a0",null).exports},name:"index",mounted:function(){var t=this.$route.query.viewNo;this.$store.commit("saveViewNo",{viewNo:t}),console.log(t)},computed:{isEquirectangular:function(){return"Auto"==this.$store.state.test.imgType||"Equirectangular"==this.$store.state.test.imgType},isCubeFaces:function(){return"Cube Faces"==this.$store.state.test.imgType},isCylindrical:function(){return"Cylindrical"==this.$store.state.test.imgType},isFlat:function(){return"Flat"==this.$store.state.test.imgType},isAddProject:function(){return this.$store.state.test.isAddProject}}},bt={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"app-container"},[t.isEquirectangular?o("equirectangular"):t._e(),t._v(" "),t.isCubeFaces?o("cube-faces"):t._e(),t._v(" "),t.isCylindrical?o("cylindrical"):t._e(),t._v(" "),t.isFlat?o("flat"):t._e()],1)},staticRenderFns:[]},It=o("VU/8")(Mt,bt,!1,null,null,null);e.default=It.exports},uMhA:function(t,e){},uPOW:function(t,e){},yh13:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.557aa338e269a86e4f06.js.map